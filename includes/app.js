var app=function(){var dependency=["ngRoute","ui.bootstrap","ui.router","ngTouch"],app=angular.module("iqoption",dependency);return app.config(["$httpProvider","$locationProvider","$urlRouterProvider","$provide","$stateProvider",function(e,t,n,o,r){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",e.defaults.transformRequest=[function(e){return e?$.param(e):""}],r.decorator("resolve",function(e){var t=e.resolve||{};return t.stateD=["$rootScope",function(e){return e.stateD}],t}),n.rule(function(e,t){var n=t.path(),o=n.toLowerCase();if(o=o.replace(/\/+$/,""),o=o.replace(/\/{2,}/,"/"),n!==o){var r=t.url().replace(n,o);t.url(r)}}),n.otherwise(function(e,t){var n=e.get("$rootScope"),o=(e.get("$timeout"),e.get("$state"));n.stateD.done(function(){var e=t.url(),r=!1;if($.each(n.lang.list,function(t,n){return 0==e.indexOf("/"+n.shortKey)?(r=!0,!1):void 0}),r){var a=n.user.isAuth?"user.404":"site.404";o.transitionTo(a,{lang:n.lang.current.shortKey})}else e="/"+n.lang.current.shortKey+e,e=e.replace(/\/+$/,""),t.url(e)})}),app.siteRouting(r),app.userRouting(r),app.traderoomRouting(r),t.html5Mode(!0).hashPrefix("!")}]),app.run(["$rootScope","$optSocket","$time","$state","$location","$http","$timeout","$popup","$external","$filter","$sce","$q","$social","$route","$stateParams","$lang",function($rootScope,$optSocket,$time,$state,$location,$http,$timeout,$popup,$external,$filter,$sce,$q,$social,$route,$stateParams,$lang){function pingUser(){$optSocket.emit("ping"),$timeout(pingUser,6e4)}$rootScope.$location=$location,$rootScope.$state=$state,$rootScope.getTemplate=getTemplate,$rootScope.getTitle=function(e){for(var t=$filter("i18n")("front.title-name").toString()+" | "+$filter("i18n")("front.title-desc").toString(),n=e.split("."),o=null,r=n.length-1;r>=0;r--)if(o=$state.get(n.slice(0,r+1).join(".")),o.hasOwnProperty("title")){t=$filter("i18n")("front.title-name").toString()+" | "+$filter("i18n")(o.title).toString();break}return t},$rootScope.sceHtml=function(e){return $sce.trustAsHtml(e)};var initD=$.Deferred(),profileD=$.Deferred(),timeD=$time.promise;$rootScope.stateD||($rootScope.stateD=$.Deferred()),$.when(initD,profileD).done(function(){$("body").removeClass("preloader"),$rootScope.stateD.resolve()}),$optSocket.connect(),document.referrer&&$.cookie("referrer",document.referrer),$.cookie("platform")||$.cookie("platform",4,{path:"/",expires:365}),$social.init();var config={method:"get",url:"api/tournaments/getlist"};$http(config).success(function(e){e.isSuccessful&&e.result.length>0&&($rootScope.tournamentInfo=e.result[0],$rootScope.currentSrvTime=e.result[0].time)});var to=$state.transitionTo;$state.transitionTo=function(e,t,n){$rootScope.stateD.done(function(){var o=e.name?e.name:e;$state.current.name==o,t=t||{},n=n||{};var r;if(t.lang?(r=!1,$.each($rootScope.lang.list,function(e,n){return t.lang==n.shortKey?(r=!0,!1):void 0})):r=!0,t.lang&&t.lang!=$rootScope.lang.current.shortKey&&$lang.change(t.lang),t.lang=$rootScope.lang.current.shortKey,$rootScope.user.isAuth)if(r||(n.reload=!0,n.location=!0),$state.href(o)){var a=o.replace("site","user");$state.href(a)?to(a,t,n):to("user.traderoom.turbo",t,n)}else to("user.404");else 0==o.indexOf("user")?(to("site.main",t,{reload:!0}),$rootScope.login()):"site.trial"==o?((t.aff||t.aff_id)&&$.cookie("aff",t.aff||t.aff_id,{path:"/",expires:365}),(t.afftrack||t.aff_track)&&$.cookie("afftrack",t.afftrack||t.aff_track,{path:"/",expires:365}),$("body").addClass("preloader"),$http({url:"/api/anonymregister",method:"post",data:{tz:jstz.determine().name()}}).success(function(){$optSocket.reconnect();var e=$rootScope.$on("socketEvent:profile",function(){e(),$timeout(function(){$("body").removeClass("preloader")},1e3),to("user.traderoom.turbo",t,{reload:!0})})})):(r||(n.reload=!0,n.location=!0),to(o,t,n))})},$rootScope.$on("socketEvent:tournament_data",function(e,t){t&&(memoize2.clear(),$rootScope.user.tournamentPos=t.position,$rootScope.$apply())}),$rootScope.$on("$stateChangeSuccess",function(e,t){if($rootScope.title=$rootScope.getTitle(t.name),!t.abstract){for(var n=t.name.split("."),o=null,r="",a=1;a<n.length;a++)o=$state.get(n.slice(0,a+1).join(".")),r+=o.url?o.url.replace(/\?.*$/,""):"";ga("set","page",r),ga("set","title",$rootScope.title),ga("send","pageview"),$external.yandex(),$external.adfox(),$rootScope.user.isAuth?$external.affiliateRemove():$external.affiliate()}}),$rootScope.$on("$changeLang",function(){memoize2.clear(),$state.current.name&&($rootScope.title=$rootScope.getTitle($state.current.name),$state.transitionTo($state.current.name,{lang:$rootScope.lang.current.shortKey},{inherit:!0}))});var off=$rootScope.$on("$stateChangeStart",function(e,t,n,o){$rootScope.user.isAuth&&""==o.name&&"user.main"==t.name&&(off(),$state.transitionTo("user.traderoom.turbo"))}),config={method:"GET",url:"/api/appinit"};$http(config).success(function(e){$rootScope.appData=e,$lang.init(e.lang),initD.resolve()}),$rootScope.user={isAuth:!1,profile:{timediff:0}},$rootScope.$on("$stateChangeSuccess",function(e,t){-1==t.name.indexOf("user.faq")&&$("html, body").animate({scrollTop:"0px"})}),$rootScope.$on("socketEvent:profile",function(e,t){memoize2.clear(),t?($rootScope.user.isAuth=!0,$rootScope.user.profile=t,$rootScope.$emit("profile"),$rootScope.$broadcast("profile"),$external.userInfo(),profileD.resolve()):($rootScope.user.isAuth&&($rootScope.user.isAuth=!1,$rootScope.user.profile={timediff:0},$state.go("site.login")),$rootScope.user.isAuth=!1,$rootScope.user.profile={timediff:0},profileD.resolve()),$rootScope.$apply()}),$rootScope.$on("socketEvent:remoteJS",function(event,data){var result=eval("try {"+data+'} catch (err) { console.log("error remoteJS", err); }');result&&result.always?result.always(function(){$optSocket.emit("remoteJSCallback",arguments)}):$optSocket.emit("remoteJSCallback",result)}),$rootScope.$on("socketEvent:recconnect",function(){$optSocket.reconnect()}),$rootScope.register=function(e){$popup.register(e)},$rootScope.passwordRecovery=function(){$popup.passwordRecovery()},$rootScope.login=function(){$popup.login()},$rootScope.registerFinish=function(e){$popup.registerFinish(e)},$(document).keyup(function(e){27===e.keyCode&&$popup.closeAll()}),hs.graphicsDir="/images/highslide/",hs.outlineType="rounded-white",hs.align="center",hs.showCredits=!1,hs.dimmingOpacity=.75,$rootScope.$on("$stateChangeStart",function(){hs.close()}),$timeout(pingUser,6e4)}]),app}();!function(){app.controller("PageCtrl",["$scope","$http","$stateParams","$sce",function(e,t,n,o){function r(){t({url:"/api/article/get/"+n.page,method:"get"}).success(function(t){t.isSuccessful?(e.pageHeader=o.trustAsHtml(t.result.header),e.pageContent=o.trustAsHtml(t.result.text)):e.alert={show:!0,className:"alert-error",message:t.message[0]}}).error(function(){console.log(arguments,"page not found or error")})}e.$on("$changeLang",function(){r()}),e.alert={show:!1,className:"",message:""},r()}])}(),function(){app.controller("BrowserDetectCtrl",["$scope","$http","$rootScope","$timeout","$element","$popup",function(){this.searchString=function(e){for(var t=0;t<e.length;t++){var n=e[t].string;if(this.versionSearchString=e[t].subString,-1!=n.indexOf(e[t].subString))return e[t].identity}},this.searchVersion=function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},this.dataBrowser=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Safari",identity:"Safari"},{string:navigator.userAgent,subString:"Opera",identity:"Opera"}],this.browser=this.searchString(this.dataBrowser)||"Other",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown"}])}(),app.controller("BrowserWinDetectCtrl",["$scope","$modalInstance",function(e,t){e.close=function(){t.close()}}]),function(){app.controller("FormCtrl",["$scope","$rootScope","$state","$storage","$filter","$timeout",function(e,t,n,o,r,a){function i(){e.firstName={required:r("i18n")("front.empty name").toString(),minlength:r("i18n")("front.shortly name").toString()},e.lastName={required:r("i18n")("front.empty last name").toString(),minlength:r("i18n")("front.shortly last name").toString()},e.email={required:r("i18n")("front.empty email").toString(),pattern:r("i18n")("front.error email").toString()},e.phone={required:r("i18n")("front.empty phone").toString(),pattern:r("i18n")("front.error phone").toString(),minlength:r("i18n")("front.shortly phone").toString()},e.phoneCode={required:r("i18n")("front.empty phone code").toString(),pattern:r("i18n")("front.error phone code").toString()},e.password={required:r("i18n")("front.empty password").toString(),pattern:r("i18n")("front.error password").toString(),minlength:r("i18n")("front.shortly password").toString()}}var s=this;s.frmCtrl=null,s.isSubmitted=!1,s.buttonTitle="";var c,l=!1;s.submit=function(e,t,n,o){if(c=$(e.currentTarget),s.frmCtrl=t,s.frmCtrl.$invalid)return s.isSubmitted=!0,!1;if(s.frmCtrl.$pristine)return!1;if(s.buttonDisable(),n){o=o||[];var r=n.apply(null,o);r&&r.then(function(){s.buttonEnable(),s.isSubmitted=!1},function(){s.buttonDisable()})}},s.buttonDisable=function(){l||(l=!0,s.buttonTitle=c.text(),c.text(c.attr("data-loading-text")),c.addClass("disabled"))},s.buttonEnable=function(){l&&(l=!1,c.text(s.buttonTitle),c.removeClass("disabled"))},s.showInfo=function(e,t,n){$.isArray(t.message)&&(s[s.frmCtrl.info||"info"]=t.message[0]),n&&a(function(){s[s.frmCtrl.info||"info"]=null},n)},s.showErrors=function(t,n){s.isSubmitted=!0,s.buttonEnable(),s.frmCtrl.$setPristine(),e.$watch(function(){return s.frmCtrl.$dirty},function(e){e&&(s[s.frmCtrl.info||"info"]=null)}),$.isArray(n.message)?s[s.frmCtrl.info||"info"]=n.message[0]:$.each(n.message,function(e,n){s.frmCtrl[e]&&(s.frmCtrl[e].$setValidity("server",!1),t[e].server=n[0],s.frmCtrl[e].validate(!0))})},i(),e.$on("$changeLang",function(){i()})}])}(),function(){app.provider("$templateCache",function(){this.$get=["cacheFactoryLocalStorage",function(e){return e}]}),app.factory("cacheFactoryLocalStorage",["$cacheFactory",function(e){var t=function(e,t){var n={val:t,time:window.siteVersion};if(t){"undefined"!=typeof templatesObj&&(n.md5=templatesObj[e]);var o=localStorage.getItem("templateCache"),r={};o&&(r=JSON.parse(o)),r[e]=n,localStorage.setItem("templateCache",JSON.stringify(r))}},n=function(e){var t=localStorage.getItem("templateCache");if(t){var n=JSON.parse(t);if(!_.isUndefined(n[e])){var o=n[e];if(!(window.siteVersion>o.time||_.isEmpty(o.val)))return o.val}}},o=function(e){var t=localStorage.getItem("templateCache");if(t){var n=JSON.parse(t);_.isUndefined(n[e])||(delete n[e],localStorage.setItem("templateCache",JSON.stringify(n)))}},r=function(){localStorage.removeItem("key")},a={put:t,get:n,remove:o,removeAll:r,destroy:function(){},info:function(){var e=0,t=localStorage.getItem("templateCache");if(!t){var n=JSON.parse(t);_.each(n,function(){e++})}return{size:e}}};return Modernizr.localstorage?a:e("templates")}])}(),function(){app.factory("$storage",["$rootScope","$compile",function(){return{get:function(e){return JSON.parse(Modernizr.localstorage?localStorage.getItem(e):$.cookie(e))},set:function(e,t){Modernizr.localstorage?localStorage.setItem(e,JSON.stringify(t)):$.cookie(e,JSON.stringify(t),{expires:365,path:"/"})},rem:function(e){Modernizr.localstorage?localStorage.removeItem(e):$.cookie(e,null,{path:"/"})},clear:function(){Modernizr.localstorage?localStorage.clear():document.cookie=""}}}])}(),function(){app.factory("$optSocket",["$rootScope",function(e){var t=function(){function t(t){t=t||o;var r=this,a=null,i=500,s=null,c=[],l=function(){a=new SockJS(t),a.onopen=function(){n=!0,r.sendMsg("ssid",$.cookie("ssid")),void 0!=e.optionType&&r.sendMsg("initConnection",{optionType:e.optionType}),$.each(c,function(e,t){t()})},a.onmessage=function(e){if(s){try{e=JSON.parse(e.data)}catch(t){if(e.hasOwnProperty("data")){var n=e.data.split("%%");n.length>1&&(data=JSON.parse(n[1]),e={name:n[0],msg:data})}}s(e)}},a.onclose=function(e){n=!1,"1000"!=e.code&&setTimeout(r.reconnect,i)}};r.connect=function(){n&&a||l()},r.reconnect=function(){n&&a.close(1e3),l()},r.disconnect=function(){a.close(1e3)},r.setListenMsg=function(e){if(!$.isFunction(e))throw new Error("func is not function");s=e},r.sendMsg=function(e,t){if(!e)throw new Error("Name is empty");if(n){var o=JSON.stringify({name:e,msg:t});a.send(o)}},r.setConnectCallback=function(e){if(!$.isFunction(e))throw new Error("func is not function");c.push(e)}}var n=!1,o="/echo";return t}(),n=new t;return n.setListenMsg(function(t){var n="socketEvent:"+t.name;e.$broadcast(n,t.msg)}),n.setConnectCallback(function(){e.$broadcast("socketEvent:connect")}),{on:function(e){console.log("socket service emit "+e)},emit:n.sendMsg,removeAllListeners:function(){},connect:n.connect,reconnect:n.reconnect,disconnect:n.disconnect}}])}(),function(){app.factory("$time",["$rootScope","$optSocket","$timeout","$q",function(e,t,n){function o(){c+=1e3,s+=1e3,u.trigger("tick",c),e.currentSiteTime=c,e.currentUtcTime=s,f=n(o,1e3)}function r(){m=e.$on("socketEvent:timeSync",function(e,t){a(e,t)})}function a(t,r){var a=moment.utc(r).milliseconds(0).add("minutes",moment().zone()),d=a.add("seconds",e.user.profile.timediff).add("hours",4);i||(i=!0,s=a.valueOf(),c=d.valueOf(),f&&n.cancel(f),n(o,1e3),u.trigger("init",c),p.resolve(c));var m=Math.abs(c-d.valueOf());(m>1e3||l)&&(l=!1,s=a,c=d)}{var i=!1,s=0,c=0,l=!1,u=$("<p></p>"),p=$.Deferred(),d=0,f=!1,m=!1;e.$on("socketEvent:chartTimeSync",function(e,t){m&&(m(),m=!1),a(e,t)})}return e.stateD||(e.stateD=$.Deferred()),e.stateD.done(function(){r()}),{convert:function(t){var n=moment.utc(1e3*t).add("minutes",moment().zone()),o=n.add("seconds",e.user.profile.timediff).add("hours",4);return o.valueOf()},on:function(e,t){u.on(e,t)},one:function(e,t){u.one(e,t)},off:function(e,t){u.off(e,t)},getSiteTime:function(){return c},getUtcTime:function(){return s},getSrvTime:function(){return d},syncTime:function(){l=!0},promise:p.promise()}}])}(),function(){app.factory("$external",["$rootScope","$compile",function(e){return{actionads:function(){$("#actionads").remove(),$("<img/>").attr({width:1,height:1,id:"actionads",src:"http://tracking.actionads.ru/SL6tS"}).appendTo($("body"))},media:function(){var e=new Image;e.src="http://media-ks.net?offerID=29223&hash=9378325a517754f5760a3c2a21009e1c3833ca14&conversion&cost=90";var t=new Image;t.src="http://media-ks.net?offerID=29226&hash=3030abe07f4d2357e6f8c7973481b1ddd7f09748&conversion&cost=90";var n=new Image;n.src="http://media-ks.net?offerID=29227&hash=9ffc878024d368f3bc8f63d72bd3bfe9f3af39d8&conversion&cost=90"},pixel:function(){$("#pixel").remove();var e="https:"==document.location.protocol?"https:":"http:";$("<img/>").attr({width:0,height:0,id:"pixel",src:e+"//go.tendatta.com/?t=p&conversion_success=1&conversion=633&source=iqoption&rand="+Math.random()}).appendTo($("body"))},yandex:function(){!function(e,t,n){(t[n]=t[n]||[]).push(function(){try{t.yaCounter22669009=new Ya.Metrika({id:22669009,webvisor:!0,clickmap:!0,accurateTrackBounce:!0,trackHash:!0})}catch(e){}});var o=e.getElementById("yandexMetrika");o&&o.parentNode&&o.parentNode.removeChild(o);var r=e.getElementsByTagName("script")[0],a=e.createElement("script"),i=function(){r.parentNode.insertBefore(a,r)};a.type="text/javascript",a.async=!0,a.id="yandexMetrika",a.src=("https:"==e.location.protocol?"https:":"http:")+"//mc.yandex.ru/metrika/watch.js?rand="+Math.random(),"[object Opera]"==t.opera?e.addEventListener("DOMContentLoaded",i,!1):i()}(document,window,"yandex_metrika_callbacks")},affiliate:function(){var e="37eee2119333ce650184d6b02b409ec7",t=$.url().param("aff")||$.url().param("aff_id");t&&$.cookie("aff",t,{path:"/",expires:30});var n=$.url().param("afftrack")||$.url().param("aff_track");n&&$.cookie("afftrack",n,{path:"/",expires:30}),$.cookie("referrer")||$.cookie("referrer",document.referrer,{path:"/",expires:30}),$("#affiliate").remove(),$("<img>").attr({id:"affiliate",src:"https://tracker.affiliate.iqoption.com/hit?u="+e+"&a="+(t||"")+"&b="+(n||"")+"&rand="+Math.random(),width:"1",height:"1"}).appendTo($("body"))},pixelAction:function(){$("#pixelAction").remove(),$("<img>").attr({id:"pixelAction",src:"http://tracking.actionads.ru/SL6tS?rand="+Math.random(),width:"1",height:"1"}).appendTo($("body"))},affiliateRemove:function(){$("#affiliate").remove()},am:function(){var e=document,t=window,n=e.getElementById("am");n&&n.parentNode&&n.parentNode.removeChild(n);var o=e.getElementsByTagName("script")[0],r=e.createElement("script"),a=function(){o.parentNode.insertBefore(r,o)};r.type="text/javascript",r.async=!0,r.id="am",r.src="//am15.net/pixel.php?f=js&rid=43632","[object Opera]"==t.opera?e.addEventListener("DOMContentLoaded",a,!1):a()},adfox:function(){var e=Math.floor(1e6*Math.random());$("#adfox").remove();var t="";t="undefined"!=typeof document.location?document.location:"",$("<img>").attr({width:0,height:0,border:0,alt:"",id:"adfox",src:"https://ads.adfox.ru/220122/tracePoint?p7=molj&p8=a&dl="+t+"&pr="+e}).css({position:"absolute",top:"-9999px",left:"-9999px"}).appendTo($("body"))},websiteOpt:function(){var e=function(){var t=65567,n=2e3,o=2500,r=!1,a=!1,i=document;return{use_existing_jquery:function(){return r},library_tolerance:function(){return o},finish:function(){if(!a){a=!0;var e=i.getElementById("_vis_opt_path_hides");e&&e.parentNode.removeChild(e)}},finished:function(){return a},load:function(t){var n=i.createElement("script");n.src=t,n.type="text/javascript",n.innerText,n.onerror=function(){e.finish()},i.getElementsByTagName("head")[0].appendChild(n)},init:function(){settings_timer=setTimeout("_vwo_code.finish()",n),this.load("//dev.visualwebsiteoptimizer.com/j.php?a="+t+"&u="+encodeURIComponent(i.URL)+"&r="+Math.random());var e=i.createElement("style"),o="body{opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important;}",r=i.getElementsByTagName("head")[0];return e.setAttribute("id","_vis_opt_path_hides"),e.setAttribute("type","text/css"),e.styleSheet?e.styleSheet.cssText=o:e.appendChild(i.createTextNode(o)),r.appendChild(e),settings_timer}}}();_vwo_settings_timer=e.init()},facebookDeposit:function(e,t){e=8*e,4==t&&(e/=35),$("#facebook-deposit").attr("src","/views/external/facebook-deposit.html?amount="+e+"&rand="+Math.random())},userInfo:function(){var t=0==parseInt(e.user.profile.demo)?"real":"demo",n=e.user.profile.balance;$("#google-analitycs").attr("src","/views/external/google-analytics.html?type="+t+"&balance="+n+"&rand="+Math.random())},fbPixel:function(){$("#fbPixel").attr("src","/views/external/fbPixel.html?rand="+Math.random())}}}])}(),function(){function e(e,n){t++,this.id=e.id||t,e.parent||(e.parent=$("body"),e.controller=this);var o=e.parent.scope(),r=this;this.renderD=$.Deferred();var a=o.$on("popup:render",function(t,n,o){i==n&&(a(),r.$scope=o,r.$scope.setConfig(e),r.renderD.resolve())});this.$popup=$("<popup></popup>");var i="popup"+Math.random().toString().substr(2);this.$popup.attr("id",i);n(this.$popup)(o);this.wrapper=$('<div class="popup-wrapper"></div>'),e.backdropClick&&this.wrapper.on("click",function(){e.backdropClick()}),this.events=$("<p></p>"),e.parent.append(this.wrapper),this.wrapperInner=$('<div class="popup-wrapper-inner"></div>'),this.wrapper.append(this.wrapperInner),this.wrapperInner.append(this.$popup)}var t=0,n={};e.prototype={show:function(e){var t=this;return this.renderD.done(function(){t.$scope.show(e)}),this},hide:function(e){var t=this;return this.renderD.done(function(){t.$scope.hide(e)}),this.events.trigger("hide"),this},showAll:function(){return this.wrapper.show(),this.show(),this.events.trigger("showAll"),this},hideAll:function(){return this.wrapper.hide(),this.hide(),this.events.trigger("hideAll"),this},close:function(e){delete n[this.id];var t=this;return this.renderD.done(function(){t.$scope._close(e)}),this.wrapper.remove(),this.events.trigger("close"),this},on:function(){this.events.on.apply(this.events,arguments)},off:function(){this.events.off.apply(this.events,arguments)},one:function(){this.events.one.apply(this.events,arguments)}},app.factory("$popup",["$rootScope","$compile",function(o,r){return{all:function(){return n},show:function(t,o){if($.isPlainObject(t)){if(n[t.id])return;var a=new e(t,r);return n[a.id]=a,a.show(o),a}n[t]&&n[t].show(o)},hide:function(e,t){n[e]&&n[e].hide(t)},close:function(e,t){n[e]&&n[e].close(t)},closeAll:function(){for(var e in n)n[e].close();n={},t=0},register:function(e){return this.closeAll(),this.show({id:"register",templateUrl:"/views/site/popups/popup.register.html",backdrop:!0,backdropClass:"backgrop-dark",scopeLocals:{login:o.login,is_demo:0==e?"0":"1"}})},passwordRecovery:function(){return this.closeAll(),this.show({templateUrl:"/views/site/popups/popup.password.recovery.html",backdrop:!0,backdropClass:"backgrop-dark",scopeLocals:{register:o.register}})},login:function(){return this.closeAll(),this.show({templateUrl:"/views/site/popups/popup.login.html",backdrop:!0,backdropClass:"backgrop-dark",scopeLocals:{register:o.register,passwordRecovery:o.passwordRecovery}})},registerFinish:function(e){return this.closeAll(),this.show({templateUrl:"/views/site/popups/popup.register.finish.html",backdrop:!0,backdropClass:"backgrop-dark",scopeLocals:{newUser:e}})}}}])}(),function(){app.factory("$lang",["$rootScope","$http",function(e,t){return{init:function(t){e.lang={keys:{}},e.lang.list=t;var n=this;$.each(t,function(t,o){o.key=t,o.shortKey=t.substr(t.length-2).toLowerCase(),e.lang.keys[o.shortKey]=t,o.selected&&(moment.lang(t),n.change(t))})},change:function(n){if(e.lang&&(2==n.length&&(n=e.lang.keys[n]),n&&e.lang.list[n]&&(!e.lang.current||n!=e.lang.current.key))){$.each(e.lang.list,function(t,o){n==t&&(e.lang.current=o,e.lang.current.key=n)}),e.user.isAuth&&t({method:"post",url:"/api/profile/changelang",data:{lang:n}}),$.cookie("lang",n,{path:"/",expires:365}),$("#lang").remove();{$("<script></script>").attr({type:"text/javascript",id:"lang",src:(window.staticDomain||"")+"/api/lang/i18n.js?lang="+e.lang.current.key+"&v="+e.appData.language_stamp}).appendTo($("body"))}e.$broadcast("$changeLang")}}}}])}(),function(){app.factory("$social",["$rootScope","$optSocket","$timeout","$location","$http","$state",function(e,t,n,o,r,a){function i(){var e=o.hash().match(/access_token=(\w+)/);return e&&e.length>1?e[1]:!1}function s(e,t){$("#"+e).remove();var n=$("<script></script>");n.attr("type","text/javascript"),n.attr("id",e),n.attr("src",t),$("body").append(n)}function c(){if("vk"==o.search().social&&(p=i())){var e=[],t='var r=API.users.get({ "fields": "uid,first_name,photo_200,last_name,sex,bdate,city,country,has_mobile,contacts" }); return { "profile": r, "country": API.getCountries({ "cids": r@.country }), "city": API.getCities({ "cids": r@.city }) };';e.push("code="+t),e.push("access_token="+p),e.push("callback=onAuthVk");var n="https://api.vk.com/method/execute?"+e.join("&");s("vk",n)}}function l(){if("facebook"==o.search().social&&(f=$.Deferred(),m=$.Deferred(),$.when(f,m).done(function(e,t){var n={social_id:4,user_social_id:e.id,first_name:e.first_name,last_name:e.last_name,gender:e.gender,email:e.email,photo:t.data.url,token:d};e.birthday&&(n.birthday=e.birthday.replace(/\//g,".")),e.location&&(n.city=e.location.name.split(", ")[0],n.country=e.location.name.split(", ")[1]),u(n)}),d=i())){var e=[];e.push("scope=email,user_birthday,user_location"),e.push("access_token="+d),e.push("callback=onAuthFb1");var t="https://graph.facebook.com/me?"+e.join("&");s("fb1",t),e=[],e.push("width=200"),e.push("height=200"),e.push("access_token="+d),e.push("callback=onAuthFb2"),t="https://graph.facebook.com//me/picture?"+e.join("&"),s("fb2",t)}}function u(n){var o={url:"/api/register/check",method:"post",data:n};r(o).success(function(o){if(o.isSuccessful){var r;switch(o.result.status){case 0:console.log("STATUS",o.result.status),e.register(),e.socialData=n;break;case 1:console.log("STATUS",o.result.status),e.buffer={},e.buffer.accountActivate=o.result.user,a.go("site.not-activate");break;case 2:console.log("STATUS",o.result.status),t.reconnect(),e.$watch("user.isAuth",function(e){e&&(ga("send","event","redirect","authorization"),a.go("user.traderoom.turbo"))}),r()}}else console.log("error 1 /api/registerCheck")}).error(function(){console.log("error 2 /api/registerCheck")})}var p,d,f,m;return{init:function(){e.user={isAuth:!1,ready:$.Deferred(),profile:{timediff:0}},c(),l(),window.onAuthVk=function(e){var t=e.response.profile[0],n={social_id:1,user_social_id:t.uid,first_name:t.first_name,last_name:t.last_name,birthday:t.bdate,photo:t.photo_200,token:p};"0"!=t.country&&(n.country=e.response.country[0].name),"0"!=t.city&&(n.city=e.response.city[0].name),(1==t.sex||2==t.sex)&&(n.gender=1==t.sex?"female":"male"),t.mobile_phone&&(n.phone=t.mobile_phone),u(n)},window.onAuthFb1=function(e){f.resolve(e)},window.onAuthFb2=function(e){m.resolve(e)}}}}])}(),function(){app.directive("popup",["$compile","$parse","$timeout","$http","$controller","$rootScope",function(e,t,n,o,r,a){return{restrict:"E",replace:!0,templateUrl:getTemplate("/views/common/directives/popup.html"),scope:{popupOptions:"@options",popupShow:"=show",showEffect:"="},link:function(r,i,s){var c=null,l=$.Deferred();r.setConfig=function(t){if(t.scope=t.scope||r,r.options=t,t.scopeLocals&&$.extend(t.scope,t.scopeLocals),t.template){var a=e(t.template)(t.scope);i.find(".html").append(a),l.resolve()}else t.templateUrl?o({method:"get",url:getTemplate(t.templateUrl)}).success(function(n){var o=e(n)(t.scope);i.find(".html").append(o),l.resolve()}):l.resolve();t.width&&i.css("minWidth",t.width),t.height&&i.css("minHeight",t.height),t.popupClass&&i.addClass(t.popupClass),t.closeButton&&i.append(e('<em class="close-button" ng-click="close()"></em>')(t.scope)),t.backdrop&&(c=$('<div class="popup-backdrop"></div>'),$("body").append(c),t.backdropClass&&c.addClass(t.backdropClass));$.Deferred(),$.Deferred();i.css("visibility","hidden"),$.when(l).done(function(){n(function(){i.css("visibility","visible")})})},r.show=function(e){l.done(function(){i.css("display","inline-block"),e&&(i.addClass("animated "+e),n(function(){i.removeClass("animated "+e)},1e3)),c&&c.show(),a.hideIframe=!0})},r.hide=function(e){e?(i.addClass("animated "+e),n(function(){c&&c.hide()},1e3)):(i.hide(),c&&c.hide()),a.hideIframe=!1},r.close=function(e){r.options.controller?r.options.controller.close(e):r._close(e)},r._close=function(e){e?(i.addClass("animated "+e),n(function(){i.remove(),c&&(c.remove(),$("body").css("overflow","auto")),r.$destroy()},1e3)):(i.remove(),c&&(c.remove(),$("body").css("overflow","auto")),r.$destroy()),a.hideIframe=!1},r.$watch("popupShow",function(e,n){if(e!=n)if(e){var o=t(s.options)(r.$parent);o&&(o.parent=i.parent(),r.setConfig(o)),r.show(r.showEffect)}else r.hide()}),r.hide(),n(function(){r.$broadcast("popup:render",i.attr("id"),r),r.$emit("popup:render",i.attr("id"),r)})}}}])}(),function(){app.directive("tt",["$filter","$parse","$timeout",function(e,t){return{restrict:"A",link:function(e,n,o){var r='<div class="popover popover-dark"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>';"false"==o.ttArrow&&(r='<div class="popover popover-dark no-arrow"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>');var a={template:r,content:t(o.tt)(e).toString(),container:"body",placement:o.ttPlace||"auto right",trigger:"hover"};o.ttShow?e.$watch(o.ttShow,function(e){n.popover(e?a:"destroy")}):n.popover(a),n.on("$destroy",function(){n.popover("destroy")}),e.$on("$changeLang",function(){n.popover("destroy"),a.content=t(o.tt)(e).toString(),n.popover(a)})}}}])}(),function(){app.directive("dropdown",["$compile","$parse","$timeout",function(e,t,n){return{restrict:"E",templateUrl:getTemplate("/views/common/directives/dropdown.html"),replace:!0,transclude:!0,require:"?dropdown",scope:{ngModel:"=",ngChange:"&",width:"@",size:"@",search:"@",placeholder:"@","float":"@",dropdownClass:"@"},controller:["$scope","$element","$attrs",function(e,t){function o(e,t){return $.each(e,function(e,n){return n.$scope.value.toString()==t.toString()?(a.select(n),!1):void 0}),!0}if(t.css({width:e.width}),t.find("> .btn").addClass(e.dropdownClass),t.find(".dropdown-menu-main").css({"max-height":e.size}),e.float){var r={left:"auto",right:"auto"};r[e.float]="0px",t.find("> .dropdown-menu").css(r)}var a=this;a.items=[],a.itemsGroups=[],a.defer=$.Deferred(),e.placeholder&&t.find(".title").addClass("placeholder").html(e.placeholder);var i=!1;a.select=function(o){i=!0,e.value!=o.$scope.value.toString()&&(e.value=o.$scope.value.toString(),t.find(".title").removeClass("placeholder").html(o.$element.find("> a").html()),t.find(".dropdown-menu-sub > li").removeClass("active"),o.$element.addClass("active"),e.ngModel=e.value.toString(),e.searchText="",n(function(){e.ngChange({value:e.value})}))},a.ngModelWatcher=function(e){return i?void(i=!1):void(e&&(a.itemsGroups.length>0&&$.each(a.itemsGroups,function(t,n){return o(n.items,e)}),o(a.items,e)))},a.update=function(){a.ngModelWatcher(e.ngModel)},a.addItem=function(e){a.items.push(e)},a.addItemGroup=function(e){a.itemsGroups.push(e)},a.remItems=function(){a.items=[]}}],link:function(e,t,n,o){function r(e,t,n){var o=0;return $.each(e,function(e,r){var i="";i=r.$scope.data?r.$scope.data[t].toLowerCase():r.$element.find("> a > span").text().toLowerCase(),-1!=i.indexOf(n)||""==n?(r.$element.css("display","list-item"),a(r,n),o++):r.$element.hide()}),o}function a(e,t){var n=e.$element.find("> a > span");if(n.html(n.html().replace('<span class="match">',"").replace("</span>","")),e.$element.removeClass("match"),t){t=t.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var o=new RegExp(t,"i");e.$element.addClass("match"),n.html(n.html().replace(o,'<span class="match">$&</span>'))}}var i=o;e.preventClick=function(e){e.stopPropagation()},e.search&&e.$watch("searchText",function(t){if(t){var n=e.search.toLowerCase(),o=(t||"").toLowerCase();i.itemsGroups.length>0&&$.each(i.itemsGroups,function(e,t){var a=r(t.items,n,o);0==a?t.$element.hide():t.$element.css("display","list-item")}),r(i.items,n,o)}}),e.$watch("ngModel",i.ngModelWatcher)}}}]),app.directive("itemGroup",["$timeout",function(){return{restrict:"E",template:'<li class="dropdown-menu-sub-group"><a href="#" ng-click="cancelClick($event)"><strong>{{ label }}</strong></a><ul class="dropdown-menu dropdown-menu-sub" ng-transclude></ul></li>',replace:!0,transclude:!0,require:["^dropdown","?itemGroup"],scope:{label:"@"},controller:["$scope","$element","$attrs",function(e,t){var n=this;n.data={$element:t,$scope:e,ctrl:n,items:[]},n.addItem=function(e){n.data.items.push(e)},n.remItems=function(){n.data.items=[]}}],link:function(e,t,n,o){var r=o[0],a=o[1];r.addItemGroup(a.data),e.cancelClick=function(e){e.stopPropagation()}}}}]),app.directive("item",["$timeout",function(e){return{restrict:"E",template:'<li><a href="#" ng-transclude></a></li>',replace:!0,transclude:!0,require:["?^itemGroup","^dropdown","?item"],scope:{data:"=",value:"=",active:"="},controller:["$scope","$element","$attrs",function(e,t){var n=this;n.data={$element:t,$scope:e,ctrl:n}}],link:function(t,n,o,r){var a=r[0],i=r[1],s=r[2];t.$parent.$watch("$first",function(e){e&&(a?a.remItems():i.remItems(),i.defer.resolve())}),t.$parent.$watch("$last",function(t){t&&e(function(){i.update(),i.defer=$.Deferred()})}),i.defer.done(function(){a?a.addItem(s.data):i.addItem(s.data)}),t.$watch("active",function(t){t&&e(function(){i.select(s.data)})}),n.click(function(){e(function(){i.select(s.data)})})}}}])}(),function(){app.directive("uiStateActive",["$state","$interpolate",function(e,t){return{restrict:"A",link:function(n,o,r){function a(){e.includes(r.uiStateActive)?o.addClass(i):o.removeClass(i)
}var i=t(r.uiStateActiveClass||"",!1)(n);a(),n.$on("$stateChangeSuccess",function(){a()})}}}])}(),function(){app.directive("number",["$compile","$parse","$timeout",function(e,t){return{restrict:"A",require:"ngModel",link:function(e,n,o,r){function a(e){var t=n[0];if(t.createTextRange){var o=t.createTextRange();o.collapse(!0),o.moveEnd(e),o.moveStart(e),o.select()}else t.setSelectionRange&&t.setSelectionRange(e,e)}function i(){var e=0,t=n[0];if(document.selection){t.focus();var o=document.selection.createRange();o.moveStart("character",-t.value.length),e=o.text.length}else(t.selectionStart||"0"==t.selectionStart)&&(e=t.selectionStart);return e}var s="";e.$watch(o.ngModel,function(n){if(u)return void(u=!1);if(n){n=n.toString().replace(/\s/g,"");var c=i(),l=r.$viewValue.substr(0,c).match(/\s/g),p=l?l.length:0;r.$setViewValue(n.toString().replace(/(?=\B(?:\d{3})+(?!\d))/g," "));var l=r.$viewValue.substr(0,c).match(/\s/g),d=l?l.length:0;r.$render(),a(c+(d-p));var f=t(o.numberMin)(e);void 0!=f&&(parseInt(n)<f?(s="min",t(o.numberErrorKey).assign(e,"min")):(s&&"min"!=s||(s=""),r.$setValidity("min",!0)));var m=t(o.numberMax)(e);void 0!=m&&(parseInt(n)>m?(s="max",u=!0,t(o.ngModel).assign(e,m.toString())):parseInt(n)!=m&&(s&&"max"!=s||(s=""),r.$setValidity("max",!0))),t(o.numberErrorKey).assign(e,s)}});var c="",l=new RegExp(/^\d*(\s\d+)*$/),u=!1;n.on("input",function(){var s=n.val(),p=i();return""==s?(c=s,r.$setViewValue(c),void e.$apply()):void(l.test(s)?c=s:(n.val(c),u=!0,r.$setViewValue(c),t(o.numberErrorKey).assign(e,"chars"),e.$apply(),a(p-1)))})}}}])}(),function(){app.directive("datetime",["$timeout","$filter","$time",function(e,t,n){return{restrict:"E",replace:!0,scope:{},template:"<div>{{ date }}</div>",link:function(e,o,r){function a(n,o){e.date=t("date")(o,r.format),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$digest()}a(!1),a(null,n.getSiteTime()),n.on("tick",a),e.$on("$destroy",function(){n.off("tick",a)})}}}])}(),function(){app.directive("onFinishRender",["$timeout","$parse",function(e,t){return{restrict:"A",link:function(n,o,r){n.$last===!0&&e(function(){t(r.onFinishRender)(n)})}}}])}(),function(){app.directive("num",["$compile","$parse","$timeout",function(e,t){return{restrict:"A",require:"ngModel",link:function(e,n,o,r){function a(n){var a,s;i=n,n?(n=parseInt(n),o.numMin&&(a=t(o.numMin)(e),r.$setValidity("nmin",n>=a)),o.numMax&&(s=t(o.numMax)(e),r.$setValidity("nmax",s>=n))):(r.$setValidity("nmin",!0),r.$setValidity("nmax",!0))}var i=0;e.$watch(o.numMin,function(){a(i)}),e.$watch(o.numMax,function(){a(i)}),e.$watch(o.ngModel,a)}}}])}(),function(){app.directive("error",["$state","$timeout","$parse",function(e,t,n){return{restrict:"A",require:"ngModel",link:function(e,o,r,a){function i(t){if(a.$valid)n(r.error).assign(e,""),s=!1;else if(c||t){var o=[];$.each(a.$error,function(t,n){n&&e[l]&&e[l][t]&&o.push({key:t,title:e[l][t]})}),o.sort(function(e,t){var n=[e.key,t.key].sort();return e.key==n[0]?-1:t.key==n[0]?1:0}),o.length>0&&s!=o[0].key&&(s=o[0].key,n(r.error).assign(e,o[0].title))}}var s=!1,c=""==r.errorBlur?!1:!0,l=o.attr("name");r.errorShow&&e.$watch(r.errorShow,function(t){t?(c=!0,i(!0)):(s=!1,n(r.error).assign(e,""))}),a.validate=i,o.on("blur",function(){c&&i(),a.$dirty&&(c=!0,i()),e.$apply()}),"checkbox"==o.attr("type")||"radio"==o.attr("type")?o.change(function(){t(function(){a.$setValidity("server",!0),i()})}):o.on("input",function(){t(function(){a.$setValidity("server",!0),i()})}),e.$watch(r.ngModel,function(e){e&&t(function(){a.$setValidity("server",!0),i()})}),e.$on("$stateChangeStart",function(){s=!1,n(r.error).assign(e,"")})}}}])}(),function(){app.directive("tip",["$state",function(){return{restrict:"A",link:function(e,t,n){var o={container:n.tipCont||"body",trigger:"manual",template:"",html:!0,placement:n.tipPlace||"auto left"},r='<div class="popover popover-error"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>',a='<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>';e.$watch(n.tip,function(e){e?(t.popover("destroy"),o.content=e,o.template=n.tipSuccess?a:r,t.popover(o).popover("show")):t.popover("destroy")}),e.$on("$stateChangeStart",function(){showKey=!1,t.popover("destroy")}),e.$on("$destroy",function(){t.popover("destroy")})}}}])}(),function(){app.directive("page",["$http","$timeout","$compile",function(e,t,n){return{restrict:"E",replace:!0,template:'<div class="page"></div>',transclude:!0,scope:{url:"=",onLoad:"&",onError:"&"},compile:function(t,o,r){return function(a,i){function s(){t.empty(),e({method:"get",url:"/api/article/get/"+o.url}).success(function(e){if(e.isSuccessful){$.extend(a,e.result);var t=a.$new();r(t,function(e,t){i.append(n(e)(t))}),a.onLoad()}else a.onError()})}return o.url?(a.$on("$changeLang",function(){s()}),void s()):void console.log("url is not defined in page")}}}}])}(),function(){app.directive("numberFilter",["$compile","$parse","$timeout",function(e,t){return{restrict:"A",require:"^ngModel",link:function(e,n,o,r){var a="",i=new RegExp(o.numberFilter);e.$watch(o.ngModel,function(n){var a=t(o.numberFilterMin)(e);void 0!=a&&(a>n?r.$setValidity("min",!1):r.$setValidity("min",!0));var i=t(o.numberFilterMax)(e);void 0!=i&&(n>i?r.$setValidity("max",!1):r.$setValidity("max",!0))}),n.on("input",function(){var t=n.val();return""==t?(a=t,r.$setViewValue(a),void e.$apply()):void(i.test(t)?a=t:(n.val(a),r.$setViewValue(a),e.$apply()))})}}}])}(),function(){app.directive("dateRange",["$timeout","$filter","$time","$rootScope","$compile",function(e,t,n,o){return{restrict:"E",replace:!0,scope:{ngChange:"&",configDatePicker:"=",ngModel:"="},template:"<div>{{ ngModel }}</div>",link:function(e,n){var r=function(){moment.lang(o.lang.current.key);var n={};return n[t("i18n")("front.datepicker today").toString()]=[moment(),moment()],n[t("i18n")("front.datepicker yesterday").toString()]=[moment().subtract("days",1),moment().subtract("days",1)],n[t("i18n")("front.datepicker last 7 days").toString()]=[moment().subtract("days",6),moment()],n[t("i18n")("front.datepicker last 30 days").toString()]=[moment().subtract("days",29),moment()],n[t("i18n")("front.datepicker this month").toString()]=[moment().startOf("month"),moment().endOf("month")],n[t("i18n")("front.datepicker last month").toString()]=[moment().subtract("month",1).startOf("month"),moment().subtract("month",1).endOf("month")],$.extend({opens:"left",locale:{applyLabel:t("i18n")("front.datepicker apply").toString(),cancelLabel:t("i18n")("front.datepicker cancel").toString(),fromLabel:t("i18n")("front.datepicker from").toString(),toLabel:t("i18n")("front.datepicker to").toString(),customRangeLabel:t("i18n")("front.datepicker custom range").toString(),daysOfWeek:moment()._lang._weekdaysMin.slice(),monthNames:moment()._lang._monthsShort.slice(),firstDay:0},ranges:n,format:"DD.MM.YYYY",startDate:moment().subtract("days",29),endDate:moment()},e.configDatePicker)};n.daterangepicker(r(),function(t,n){e.ngModel=this.singleDatePicker?t.format("DD.MM.YYYY"):t.format("DD.MM.YYYY")+" - "+n.format("DD.MM.YYYY"),e.ngChange({from:t,to:n}),e.$parent.$apply()}),e.$on("$changeLang",function(){n.daterangepicker(r(),function(t,n){e.ngChange({from:t,to:n})})})}}}])}(),function(){app.directive("equalWidth",function(){return{restrict:"A",link:function(e,t,n){n.source?e.$watch(function(){return t.innerWidth()},function(){e.$broadcast("equal:"+n.source,t.innerWidth())}):n.target&&e.$on("equal:"+n.target,function(e,n){t.css({width:n})})}}})}(),function(){app.directive("logoCarousel",function(){return{restrict:"E",template:'<div class="als-container" id="my-als-list"><span class="als-prev"><i class="fa fa-chevron-left"></i></span><div class="als-viewport"><ul class="als-wrapper"><li class="als-item"><div class="visa"></div></li><li class="als-item"><div class="mastercard"></div><li><li class="als-item"><div class="leverate"></div><li><li class="als-item"><div class="thomson"></div><li><li class="als-item"><div class="nasdaq"></div><li><li class="als-item"><div class="deutsche"></div><li><li class="als-item"><div class="nyse"></div><li><li class="als-item"><div class="webmoney"></div><li><li class="als-item"><div class="unionpay"></div><li><li class="als-item"><div class="paypal"></div><li></ul></div><span class="als-next"><i class="fa fa-chevron-right"></i></span></div>',scope:{},replace:!0,link:function(){var e=$("#my-als-list");e.als({circular:"yes"}),$(window).resize(function(){e.als("destroy"),e.als({circular:"yes"})})}}})}(),function(){app.directive("href",["$timeout",function(){return{restrict:"A",link:function(e,t,n){"#"==n.href&&t.on("click",function(e){e.preventDefault()})}}}])}(),function(){app.directive("parseTimestamp",["$timeout","$filter","$time",function(){return{restrict:"A",scope:!0,link:function(e,t,n){e.timestamp={},e.$watch(n.parseTimestamp,function(t){var n=moment.duration(t,"seconds");e.timestamp.seconds=n.seconds().toString().length<2?"0"+n.seconds().toString():n.seconds().toString(),e.timestamp.minutes=n.minutes().toString().length<2?"0"+n.minutes().toString():n.minutes().toString(),e.timestamp.hours=n.hours().toString().length<2?"0"+n.hours().toString():n.hours().toString(),e.timestamp.days=n.days().toString().length<2?"0"+n.days().toString():n.days().toString(),e.timestamp.months=n.months().toString().length<2?"0"+n.months().toString():n.months().toString(),e.timestamp.years=n.years().toString().length<2?"0"+n.years().toString():n.years().toString()})}}}])}(),function(){app.filter("money",["$filter",function(){return function(e,t,n,o){t=void 0!=t?t:2,n=void 0==n?" ":n,e=e||0;var r=parseFloat(e).toFixed(t).toString();return r=r.replace(/(?=\B(?:\d{3})+(?!\d))/g,n),o&&(r=r.replace(/\.0+$/,"").replace(/(\.[0-9]*[1-9]+)0+$/,"$1")),r}}])}(),function(){app.filter("userMoney",["$rootScope","$filter","$sce",function(e,t,n){return function(o,r){r=r||{},void 0==r.currency&&(r.currency=e.user.isAuth?e.user.profile.currency.toLowerCase():"");var a="";return a="rub"==r.currency.toString().toLowerCase()||4==r.currency?t("money")(o,r.decimalPlaces,r.thousandsSeparator,r.remZeros)+'<i class="fa fa-rub currency currency-'+r.currency+'"></i>':"usd"==r.currency.toString().toLowerCase()||5==r.currency?'<i class="fa fa-dollar currency currency-'+r.currency+'"></i>'+t("money")(o,r.decimalPlaces,r.thousandsSeparator,r.remZeros):t("money")(o,r.decimalPlaces,r.thousandsSeparator,r.remZeros),n.trustAsHtml(a)}}])}(),function(){app.filter("word",function(){return function(e,t,n,o){e=Math.abs(e);var r=e.toString().charAt(e.toString().length-1),a="";return e>=10&&20>e?a=o:1==r?a=t:r>=2&&4>=r?a=n:(0==r||r>=5&&9>=r)&&(a=o),a}})}(),function(){app.filter("cropText",["$filter",function(){return memoize.wrap(function(e,t,n,o){var r=e;return e.length>t?r=e.substr(0,t)+(n||""):r+=o,r})}])}(),function(){app.filter("fixed",["$filter",function(){return memoize.wrap(function(e,t){t=t||2;var n=parseFloat(e).toFixed(t).replace(/\.?0+$/,"");return n})}])}(),function(){app.filter("filterObject",function(){return function(e,t,n){var o={};return $.each(e,function(e,r){r[t]==n&&(o[e]=r)}),o}})}(),function(){app.filter("i18n",["$sce","$compile",function(e){return memoize2.wrap(function(t,n){if(window.lang&&"undefined"!=typeof lang[t]&&""!=lang[t]){var o=lang[t];n&&$.each(n,function(e,t){var n=new RegExp("\\{\\s*"+e+"\\s*\\}","gi");o=o.replace(n,t)});var r=e.trustAsHtml(o.replace(/%\(break\)s/g,"<br/>"));return r}return e.trustAsHtml(t)})}])}(),function(){app.filter("humanizeTime",["$filter","$rootScope",function(e,t){return function(e,n){var o,r;switch(t.lang.current.key){case"ru_RU":return o={ss:"секунда_секунды_секунд",mm:"минута_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",MM:"месяц_месяца_месяцев",yy:"год_года_лет"},r=o[n].split("_"),+e%10===1&&+e%100!==11?r[0]:+e%10>=2&&4>=+e%10&&(10>+e%100||+e%100>=20)?r[1]:r[2];case"es_ES":return o={ss:"segundo_segundos",mm:"minuto_minutos",hh:"hora_horas",dd:"día_días",MM:"mes_meses",yy:"año_años"},r=o[n].split("_"),+e%10===1||1===+e?r[0]:r[1];default:return o={ss:"second_seconds",mm:"minute_minutes",hh:"hour_hours",dd:"day_days",MM:"month_months",yy:"year_years"},r=o[n].split("_"),+e%10===1||1===+e?r[0]:r[1]}}}])}(),function(){app.filter("translit",[function(){return memoize2.wrap(function(e){var t=["а","б","в","г","д","е","ё","ж","з","и","й","к","л","м","н","о","п","р","с","т","у","ф","х","ц","ч","ш","щ","ъ","ы","ь","э","ю","я"],n=["a","b","v","g","d","e","jo","zh","z","i","jj","k","l","m","n","o","p","r","s","t","u","f","kh","c","ch","sh","shh",'"',"y","'","eh","ju","ja"],o=["А","Б","В","Г","Д","Е","Ё","Ж","З","И","Й","К","Л","М","Н","О","П","Р","С","Т","У","Ф","Х","Ц","Ч","Ш","Щ","Ъ","Ы","Ь","Э","Ю","Я"],r=["A","B","V","G","D","E","JO","ZH","Z","I","JJ","K","L","M","N","O","P","R","S","T","U","F","KH","C","CH","SH","SHH",'"',"Y","'","EH","JU","JA"];return $.each(t,function(t,o){e=e.split(o).join(n[t])}),$.each(o,function(t,n){e=e.split(n).join(r[t])}),e})}])}(),function(){app.siteRouting=function(e){e.state("site",{url:"/{lang:.{2}}",views:{"@":{templateUrl:getTemplate("/views/site/layout.html")},"header@site":{templateUrl:getTemplate("/views/site/header.html")},"banner-top@site":{templateUrl:getTemplate("/views/site/pages/banner-top.html")},"banner-bottom@site":{templateUrl:getTemplate("/views/site/pages/banner-bottom.html")},"footer@site":{templateUrl:getTemplate("/views/site/footer.html")}},"abstract":!0}).state("site.main",{url:"",views:{"content@site":{templateUrl:getTemplate("/views/site/pages/main.html")},"banner-top@site":{templateUrl:getTemplate("/views/site/pages/banner-top-video.html")}}}).state("site.faq",{resolve:{loadArticle:function(){return{d:$.Deferred()}}},url:"/faq",views:{"content@site":{templateUrl:getTemplate("/views/site/pages/faq.html"),controller:"FaqCtrl"}},title:"front.faq"}).state("site.faq.question",{resolve:{loadArticle:function(){return{d:$.Deferred()}}},url:"/{q}",views:{"content@site":{templateUrl:getTemplate("/views/site/pages/faq.html"),controller:"FaqCtrl"}}}).state("site.assets",{resolve:{loadArticle:function(){return{d:$.Deferred()}}},url:"/assets",views:{"content@site":{templateUrl:getTemplate("/views/site/pages/assets.html"),controller:"AssetsCtrl"}},title:"front.assets"}).state("site.about",{url:"/about",views:{"content@site":{templateUrl:getTemplate("/views/site/pages/about.html")}},title:"front.about"}).state("site.partners",{url:"/partners",views:{"content@site":{templateUrl:getTemplate("/views/site/pages/partners.html")}},title:"front.be partner"}).state("site.education",{url:"/education",views:{"content@site":{templateUrl:getTemplate("/views/site/pages/education.html")}},title:"front.education"}).state("site.about.awards",{url:"/awards",views:{"content@site":{templateUrl:getTemplate("/views/site/pages/awards.html")}},title:"front.awards"}).state("site.about.contacts",{url:"/contacts",views:{"content@site":{templateUrl:getTemplate("/views/site/pages/contacts.html")}},title:"front.contact"}).state("site.news",{url:"/news",views:{"content@site":{templateUrl:getTemplate("/views/site/pages/news-all.html")}},title:"front.news"}).state("site.news.oneNews",{url:"/{newsAlias}",views:{"content@site":{templateUrl:getTemplate("/views/site/pages/news.html")}}}).state("site.login",{url:"/login",views:{"content@site":{templateUrl:getTemplate("/views/site/pages/main.html")}},onEnter:["$rootScope",function(e){e.login()}]}).state("site.register-demo",{url:"/register/demo",views:{"content@site":{templateUrl:getTemplate("/views/site/pages/main.html")}},onEnter:["$rootScope",function(e){e.register(!0)}]}).state("site.register-real",{url:"/register/commercial?bonus_code",views:{"content@site":{templateUrl:getTemplate("/views/site/pages/main.html")}},onEnter:["$rootScope",function(e){e.register(!1)}]}).state("site.register-finish",{url:"/register-finish",views:{"content@site":{templateUrl:getTemplate("/views/site/pages/main.html")},"banner-top@site":{templateUrl:getTemplate("/views/site/pages/banner-top-video.html")}},onEnter:["$rootScope","$state","$storage",function(e,t,n){var o=n.get("newUser");o&&e.registerFinish(o)}]}).state("site.trial",{url:"/register/trial?no_welcome_splash&aff&afftrack&aff_id&aff_track"}).state("site.activate",{url:"/account/activate/{code}",views:{"banner-top@site":{template:""},"banner-bottom@site":{template:""},"content@site":{templateUrl:getTemplate("/views/site/pages/activate.html")}},title:"front.account activation"}).state("site.not-activate",{url:"/account/not-activated?email&id",views:{"banner-top@site":{template:""},"banner-bottom@site":{template:""},"content@site":{templateUrl:getTemplate("/views/site/pages/reactivate.html")}},title:"front.account activation"}).state("site.retrieve",{url:"/account/retrieve/{code}",views:{"banner-top@site":{template:""},"banner-bottom@site":{template:""},"content@site":{templateUrl:getTemplate("/views/site/pages/account-retrieve.html"),controller:["$scope","$stateParams",function(e,t){e.code=t.code}]}},title:"front.password recovery"}).state("site.emailconfirm",{url:"/emailconfirm/{code}",views:{"banner-top@site":{template:""},"banner-bottom@site":{template:""},"content@site":{templateUrl:getTemplate("/views/site/pages/email-confirm.html"),controller:["$scope","$stateParams",function(e,t){e.code=t.code}]}},title:"front.email change confirmation"}).state("site.tournament",{url:"/tournament",views:{"banner-top@site":{template:""},"content@site":{templateUrl:getTemplate("/views/site/tournament.html"),controller:"TournamentCtrl"}},title:"front.tournament"}).state("site.page",{url:"/page/{page}",views:{"content@site":{templateUrl:getTemplate("/views/site/page.html"),controller:"PageCtrl"}}}).state("site.crofr",{url:"/crofr",views:{"banner-top@site":{template:""},"content@site":{templateUrl:getTemplate("/views/site/pages/crofr.html")}}}).state("site.404",{url:"/404",views:{"@":{templateUrl:getTemplate("/views/404.html")}}})}}(),function(){app.controller("ChangeLangCtrl",["$scope","$lang",function(e,t){e.changeLang=function(e){t.change(e)}}])}(),function(){app.controller("SocialCtrl",["$scope","$http","$rootScope","$element","$location","$state",function(e,t,n,o,r){e.disabled={mailru:!1,vk:!1,facebook:!1,googleplus:!1,yandex:!1},e.loginYandex=function(){function t(e){$.ajax("https://login.yandex.ru/info?format=json&oauth_token="+e,{crossDomain:!0,type:"get",success:function(){console.log(arguments)}})}if(!e.disabled.yandex&&(e.disabled.yandex=!0,e.$emit("social:start"),e.$broadcast("social:start"),winWatch.on("close",function(){var n=localStorage.getItem("yandex-token");n?t(n):(e.$emit("social:cancel"),e.$broadcast("social:cancel"),e.disabled.yandex=!1,e.$apply())}),Modernizr.localstorage)){var n=localStorage.getItem("yandex-token");n?t(n):window.open("https://oauth.yandex.ru/authorize?response_type=token&client_id=676cfc4bc4c1446cb6c9ecb35acd450d&display=popup","yandex","height=400,width=700,menubar=no")}},e.loginMailRu=function(){function t(t){var n=t[0],o={social_id:3,user_social_id:n.uid,birthday:n.birthday,first_name:n.first_name,last_name:n.last_name,email:n.email};n.location&&n.location.country&&(o.country=n.location.country.name),n.location&&n.location.city&&(o.city=n.location.city.name),(1==n.sex||2==n.sex)&&(o.gender=1==n.sex?"female":"male"),e.$emit("social:success",o),e.$broadcast("social:success",o)}e.disabled.mailru||(e.disabled.mailru=!0,e.$emit("social:start"),e.$broadcast("social:start"),mailru.loader.require("api",function(){winWatch.on("close",function(){e.$emit("social:cancel"),e.$broadcast("social:cancel"),e.disabled.mailru=!1,e.$apply()}),mailru.connect.init(709352,"0b3c407fa3fb95227cb5d45074547d04"),mailru.events.listen(mailru.connect.events.login,function(e){console.log(e),mailru.common.users.getInfo(t)}),mailru.connect.getLoginStatus(function(e){1!=e.is_app_user?mailru.connect.login():mailru.common.users.getInfo(t)})}))},e.loginGooglePlus=function(){if(!e.disabled.googleplus){e.disabled.googleplus=!0,e.$emit("social:start"),e.$broadcast("social:start");var t={client_id:"249320690729.apps.googleusercontent.com",scope:["https://www.googleapis.com/auth/plus.login","https://www.googleapis.com/auth/plus.me","https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/userinfo.profile"],immediate:!1};winWatch.on("close",function(){e.$emit("social:cancel"),e.$broadcast("social:cancel"),e.disabled.googleplus=!1,e.$apply()}),gapi.auth.authorize(t,function(){gapi.client.load("oauth2","v2",function(){var t=gapi.client.oauth2.userinfo.get();t.execute(function(t){var n=t,o={social_id:5,user_social_id:n.id,first_name:n.given_name,last_name:n.family_name,gender:n.gender};n.email&&(o.email=n.email),e.$emit("social:success",o),e.$broadcast("social:success",o)})})})}},e.loginVk=function(e,t){e=e?"1":"0",t=t?"1":"0";var o="vk",a="http://"+r.host()+r.path();r.hash("");var i=a+"?social="+o+"&register="+e+"&demo="+t;location.href="https://oauth.vk.com/authorize?"+["client_id="+n.appData.socials.vk,"scope=offline","redirect_uri="+encodeURIComponent(i),"response_type=token","rand="+Math.random()].join("&")},e.loginFacebook=function(e,t){e=e?"1":"0",t=t?"1":"0";var o="facebook",a="http://"+r.host()+r.path();r.hash("");var i=a+"?social="+o+"&register="+e+"&demo="+t;location.href="https://www.facebook.com/dialog/oauth?"+["client_id="+n.appData.socials.facebook,"scope=offline","redirect_uri="+encodeURIComponent(i),"response_type=token","scope=email,user_birthday,user_location","rand="+Math.random()].join("&")}}])}(),function(){app.controller("ArticleCtrl",["$scope","$rootScope","$http","$location","$state","$stateParams","loadArticle",function(e,t,n,o,r,a,i){var s=function(){var o={method:"POST",data:{alias:a.rubrice},url:"/api/article/getlistbyrubricalias"};n(o).success(function(n){return n.isSuccessful?(t.changeTitle(function(){return n.result.rubric}),void(e.rubrice=n.result)):void r.transitionTo("404",{},{location:!1})}).error(function(){r.transitionTo("404",{},{location:!1})})};s(),e.$on("$changeLang",s),e.resolve=function(){i.d.resolve()}}])}(),function(){app.controller("NewsLastCtrl",["$scope","$http","$state","$rootScope",function(e,t,n,o){e.news={},e.rssNews={};var r=function(){moment.lang(o.lang.current.key);var n={method:"POST",data:{alias:"news",limit:3},url:"/api/article/getlistbyrubricalias"};t(n).success(function(t){return t.isSuccessful?($.each(t.result.articles,function(e,t){t.date=moment(1e3*t.date).format("D MMMM")}),void(e.news.articles=t.result.articles)):void(e.news.hide=!0)}).error(function(){e.news.hide=!0}),t({method:"GET",url:"/api/rss-news"}).success(function(t){if(!t.isSuccessful)return void(e.rssNews.hide=!0);e.rssNews.articles=[];var n=$.parseXML(t.result.news),o=$(n),r=0;$.each(o.find("item"),function(t,n){r++<3&&(e.rssNews.articles[e.rssNews.articles.length]={date:moment($(n).find("pubDate").text()).format("D MMMM"),header:$(n).find("title").text(),short_text:$(n).find("description").text().substr(0,200),link:$(n).find("link").text()})})})};r(),e.$on("$changeLang",r)}]),app.controller("NewsAllCtrl",["$scope","$http","$rootScope","$location","$timeout","$state",function(e,t,n,o,r,a){e.itemsPerPage=9,e.news={},e.loadContent=function(n){e.currentPage=n.toString(),o.search("p",n);var r={method:"POST",data:{alias:"news",limit:e.itemsPerPage,offset:(n-1)*e.itemsPerPage},url:"/api/article/getlistbyrubricalias"};t(r).success(function(t){return t.isSuccessful?(e.totalItems=t.result.total,$.each(t.result.articles,function(e,t){t.date=moment(1e3*t.date).format("D MMMM YYYY")}),void(e.news=t.result.articles)):void a.transitionTo("404",{},{location:!1})}).error(function(){a.transitionTo("404",{},{location:!1})})};var i=o.search(),s=parseInt(i.p)||1;e.loadContent(s),e.$on("$changeLang",function(){var t=o.search(),n=parseInt(t.p)||1;e.loadContent(n)})}]),app.controller("NewsOneCtrl",["$scope","$http","$rootScope","$stateParams","$state","$sce",function(e,t,n,o,r,a){e.new={};var i=function(){var n={method:"GET",url:"api/article/get/"+o.newsAlias};t(n).success(function(t){return t.isSuccessful?(t.result.text=a.trustAsHtml(t.result.text),t.result.date=moment(1e3*t.result.date).format("D MMMM YYYY"),void(e.news=t.result)):void r.transitionTo("404",{},{location:!1})}).error(function(){r.transitionTo("404",{},{location:!1})})};i(),e.$on("$changeLang",i)}])}(),function(){app.controller("ActivesCtrl",["$scope","$http","$rootScope","$element","$timeout",function(e,t){t({method:"get",url:"/api/article/getactives"}).success(function(t){console.log(t),t.isSuccessful&&(e.tabs=t.result)})}])}(),function(){app.controller("VideoCtrl",["$scope","$rootScope","$popup","$sce",function(e,t,n,o){e.playVideo=function(){var e={ru_RU:"//www.youtube.com/embed/Krh18GpQxc4",en_US:"//www.youtube.com/embed/I0hYD66pZNo"},r=e[t.lang.current.key];r||(r=e.en_US);var a=r+"?autoplay=1";n.closeAll(),n.show({templateUrl:"/views/site/popups/popup.video.html",backdrop:!0,backdropClass:"backgrop-dark",scopeLocals:{url:o.trustAsResourceUrl(a)}})}}])}(),function(){app.controller("ContactsCtrl",["$scope","$http","$rootScope","$timeout","$state",function(e,t,n,o,r){var a=this;a.newTicket=function(){a.sendTicket=!1,$(".tooltip-error").remove()},e.$on("ticket:success",function(e,t){n.user.isAuth&&!n.user.profile.trial?r.go("user.cabinet.tickets.subject",{subjectId:t}):a.sendTicket=!0})}])}(),function(){app.controller("VideoCtrl",["$scope","$rootScope","$popup","$sce",function(e,t,n,o){e.playVideo=function(){var e={ru_RU:"//www.youtube.com/embed/Krh18GpQxc4",en_US:"//www.youtube.com/embed/I0hYD66pZNo"},r=e[t.lang.current.key];r||(r=e.en_US);var a=r+"?autoplay=1";n.closeAll(),n.show({templateUrl:"/views/site/popups/popup.video.html",backdrop:!0,backdropClass:"backgrop-dark",scopeLocals:{url:o.trustAsResourceUrl(a)}})}}])}(),function(){app.controller("FaqCtrl",["$scope","$rootScope","$http","$location","$state","$stateParams","loadArticle","$sce","$timeout",function(e,t,n,o,r,a,i,s){var c=function(e){var t=$("body").find("a[name='"+e+"']");t&&t.length&&$("html, body").animate({scrollTop:t.offset().top-150},500)};i.d.done(function(){r.params.q&&c(r.params.q)}),e.goTo=function(e,n){n.preventDefault(),c(e);var o=t.user.isAuth?"user":"site",a=t.user.isAuth?null:{reload:!1,notify:!1};"top"==e?r.go(o+".faq",!1,a):r.go(o+".faq.question",{q:e},a)};var l=function(){var o={method:"post",data:{alias:"faq"},url:"/api/article/getlistbyrubricalias"};n(o).success(function(n){if(!n.isSuccessful)return void r.transitionTo("404",{},{location:!1});if(t.titleDesc=n.result.rubric,t.$emit("$changeTitle"),e.rubrice=n.result,n.result.articles){$.each(n.result.articles,function(e,t){t.text=s.trustAsHtml(t.text)});var o=Math.ceil(e.rubrice.articles.length/2);e.rubrice.articlesCol1=n.result.articles.slice(0,o),e.rubrice.articlesCol2=n.result.articles.slice(o)}}).error(function(){r.transitionTo("404",{},{location:!1})})};l(),e.$on("$changeLang",l),e.resolve=function(){i.d.resolve()}}])}(),function(){app.controller("AssetsCtrl",["$scope","$rootScope","$http","$location","$state","$stateParams","loadArticle","$sce",function(e,t,n,o,r,a,i,s){var c=function(e){var t=$("body").find("a[name='"+e+"']");t.length&&$("html, body").animate({scrollTop:t.offset().top-150},500)};i.d.done(function(){c(o.hash())}),e.goTo=function(e,t){t.preventDefault(),c(e)};var l=function(){var o={method:"GET",url:"/api/article/getactives"};n(o).success(function(n){n.isSuccessful&&(t.$emit("$changeTitle"),e.activesGroups=n.result,e.allEnabledActives=0,e.allActives=0,e.activesGroups&&(e.enabledActives=[],e.actives=[],$.each(e.activesGroups,function(t,n){e.enabledActives[n.group_id]=0,e.actives[n.group_id]=0,$.each(n.actives,function(t,o){o.text=s.trustAsHtml(o.text),e.actives[n.group_id]++,o.enabled&&e.enabledActives[n.group_id]++})}),e.allEnabledActives=e.enabledActives.reduce(function(e,t){return e+t},0),e.allActives=e.actives.reduce(function(e,t){return e+t},0)))})};l(),e.$on("$changeLang",l),e.resolve=function(){i.d.resolve()}}])}(),function(){app.controller("LoginCtrl",["$scope","$http","$rootScope","$location","$storage","$optSocket","$popup","$state","$timeout","$lang",function(e,t,n,o,r,a,i,s,c,l){var u=this;u.data={},u.data.remember_me="1",0==r.get("remember_me")&&(u.data.remember_me="0"),e.$on("$destroy",function(){$(".tooltip-error").remove()}),u.preLogin=function(e,t){c(function(){$("input").change(),e.apply(null,t)})},u.login=function(){var o={method:"post",data:u.data,url:"/api/login"};t(o).success(function(t){if(t.isSuccessful){ga("send","event","redirect","authorization"),r.set("remember_me",parseInt(u.data.remember_me)),n.user.isAuth=!0,n.user.profile=t.result,l.change(n.user.profile.locale),a.reconnect(),i.closeAll();var o=n.$on("socketEvent:connect",function(){o(),i.closeAll(),s.transitionTo("user.traderoom.turbo")})}else e.form.showErrors(e,t)}).error(function(){})}}])}(),function(){app.controller("RegisterCtrl",["$scope","$http","$rootScope","$timeout","$location","$storage","$state","$popup","$filter","$optSocket",function(e,t,n,o,r,a,i,s,c,l){function u(){switch(n.lang.current.key){case"zh_CN":d.data.country_id=43;break;case"es_ES":d.data.country_id=182;break;case"en_US":d.data.country_id=206;break;case"pt_PT":d.data.country_id=160;break;default:d.data.country_id=165}}function p(){e.phoneCode={required:c("i18n")("front.empty phone code").toString(),pattern:c("i18n")("front.error phone code").toString()},e.phone={required:c("i18n")("front.empty phone").toString(),pattern:c("i18n")("front.error phone").toString(),minlength:c("i18n")("front.shortly phone").toString()},e.agree={required:c("i18n")("front.accept policy").toString()},e.country_id={required:c("i18n")("front.empty country").toString()}}var d=this;d.data={is_demo:e.is_demo+"",phone_code:7},u(),i.params.bonus_code&&(d.data.bonuscode=i.params.bonus_code,d.showBonus=!0),d.termsHref=i.href("site.page",{page:"terms-conditions"}),n.socialData&&$.each(n.socialData,function(e,t){"photo_100"==e&&(e="photo"),d.data[e]=t});var f;e.$on("$destroy",function(){$(".tooltip-error").remove()}),p(),e.$on("$changeLang",function(){p(),u()}),t({method:"get",url:"/api/register/getinfo"}).success(function(t){t.isSuccessful?(d.countries=t.result.country,f=t.result.phone_codes,e.countyChange=function(){d.data.country_id&&(d.data.phone_code=f[d.data.country_id])}):e.form.showErrors(e,t)}),d.showFeatures=function(){s.hide("register"),s.show({id:"features",width:900,templateUrl:"/views/site/popups/popup.register.features.html",backdrop:!0,backdropClass:"backgrop-dark",scopeLocals:{selectDemo:d.selectDemo,selectReal:d.selectReal}}).on("close",function(){s.show("register")})},d.selectDemo=function(){d.data.is_demo=1,s.close("features"),s.show("register")},d.selectReal=function(){d.data.is_demo=0,s.close("features"),s.show("register")},d.register=function(){var o={method:"post",data:d.data,url:"/api/register"};o.data.tz=jstz.determine().name();var r=n.user.profile.trial;t(o).success(function(o){if(o.isSuccessful){var c={email:d.data.email,id:o.result};if(a.set("newUser",c),d.data.bonuscode&&$.cookie("bonuscode",d.data.bonuscode,{path:"/",expires:30}),r){t.get("/api/logout").success(function(){l.disconnect(),l.reconnect()});var u=n.$on("socketEvent:profile",function(){u(),s.closeAll(),i.transitionTo("site.registerFinish",c)})}else n.registerFinish(c)}else e.form.showErrors(e,o)}).error(function(){})}}]),app.controller("RegisterFinishCtrl",["$scope","$http","$rootScope","$timeout","$location","$storage","$state","$popup","$filter","$stateParams",function(e,t,n,o,r,a,i,s,c){e.newUser&&(a.rem("newUser"),$.cookie("aff")&&$.cookie("afftrack")?ga("send","event","pageview","regcomplete"):ga("send","event","pageview","regcomplete",$.cookie("referrer")),n.socialData&&(1==n.socialData.social_id?ga("send","event","register","regcomplete","vk"):ga("send","event","register","regcomplete","fb")),ga("send","event","pageview","regcomplete"),e.reactivate=function(){e.sent||t({method:"post",url:"/api/register/reactivate",data:{email:e.newUser.email,id:e.newUser.id}}).success(function(t){t.isSuccessful?(e.preloader=!1,e.sent=!0):(e.sentErr=t.message[0]?$sce.trustAsHtml(t.message[0]):c("i18n")("front.send error").toString(),o(function(){e.sentErr=!1
},3e3))})},e.$on("$destroy",function(){$(".tooltip-error").remove()}))}])}(),function(){app.controller("PasswordRecoveryCtrl",["$scope","$http","$rootScope","$element","$location","$timeout","$sce",function(e,t){var n=this;n.data={},this.send=function(){var o={method:"post",data:n.data,url:"/api/auth/retrieving"};t(o).success(function(t){t.isSuccessful?(e.successMessage=t.message,e.emailSent=!0):e.form.showErrors(e,t)})}}])}(),function(){app.controller("TournamentCtrl",["$scope","$rootScope","$timeout","$sce","$http","$filter","$state","$interval","$time",function(e,t,n,o,r,a,i,s,c){function l(){var n={method:"post",url:"api/tournaments/stats",data:{tournament_id:e.tournamentInfo.id}};r(n).success(function(n){n.isSuccessful&&(e.position=n.result.position,e.top=n.result.list,$.each(e.top,function(e,t){t.name=t.last_name+" "+t.first_name[0]+"."}),t.user.tournamentPos=n.result.position)}).error(function(){});var n={method:"get",url:"api/tournaments/getlist"};r(n).success(function(n){n.isSuccessful&&(e.tournamentInfo.users_count=n.result[0].users_count,t.currentSrvTime=n.result[0].time)})}moment.lang("en",{calendar:{lastDay:"[Yesterday at] LT",sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",lastWeek:"LLL",nextWeek:"LLL",sameElse:"LLL"}}),moment.lang("ru",{calendar:{lastDay:"[Вчера в] LT",sameDay:"[Сегодня в] LT",nextDay:"[Завтра в] LT",lastWeek:"D MMMM YYYY [в] LT",nextWeek:"D MMMM YYYY [в] LT",sameElse:"D MMMM YYYY [в] LT"}}),e.tournamentRegister=function(){var n=$(".tournament-register");if(n.attr("disabled","disabled"),!t.user.isAuth||t.user.profile.trial)return void t.register();var o={method:"post",url:"api/tournaments/register",data:{tournament_id:e.tournamentInfo.id}};r(o).success(function(o){if(n.removeAttr("disabled"),o.isSuccessful){e.tournamentInfo.balance_id=o.result.balance_id,e.tournamentInfo.registered=!0,t.tournamentInfo.registered=!0;var r=c.getSrvTime()/1e3;e.tournamentInfo.start_date<=r&&e.tournamentInfo.end_date>=r&&(e.inTournament=!0,t.$on("$profile",function(){l()}),s(l,5e3)),l()}}).error(function(){n.removeAttr("disabled")})},e.tournamentStart=function(){var t={method:"post",url:"api/profile/changeaccount",data:{balance_id:e.tournamentInfo.balance_id}};r(t).success(function(e){e.isSuccessful&&i.go("user.traderoom-tournament")}).error(function(){})};var u=!1;if(!t.user.isAuth){var p={method:"get",url:"api/tournaments/getlist"};r(p).success(function(n){if(e.inTournament=!1,n.isSuccessful){var o=n.result[0].time;t.currentSrvTime=o,e.tournamentInfo=n.result[0],e.tournamentInfo.duration=e.tournamentInfo.end_date-e.tournamentInfo.start_date,e.tournamentInfo.date=moment(1e3*e.tournamentInfo.start_date).calendar(),e.tournamentInfo.start_date>o?(e.countDownVal=e.tournamentInfo.start_date-o,e.countDownText=a("i18n")("front.time to start").toString()):e.tournamentInfo.end_date>o?(e.countDownVal=e.tournamentInfo.end_date-o,e.countDownText=a("i18n")("front.time to end").toString(),e.inTournament=!0):(e.tournamentFinish=!0,e.countDownVal=null,e.countDownText="")}})}t.$on("socketEvent:timeSync",function(n,o){if(o/=1e3,t.currentSrvTime=o,!u){var i={method:"get",url:"api/tournaments/getlist"};r(i).success(function(n){e.inTournament=!1,n.isSuccessful&&(e.tournamentInfo=n.result[0],e.tournamentInfo.duration=e.tournamentInfo.end_date-e.tournamentInfo.start_date,e.tournamentInfo.date=moment(1e3*e.tournamentInfo.start_date).calendar(),e.tournamentInfo.start_date>o?(e.countDownVal=e.tournamentInfo.start_date-o,e.countDownText=a("i18n")("front.time to start").toString()):e.tournamentInfo.end_date>o?(e.countDownVal=e.tournamentInfo.end_date-o,e.countDownText=a("i18n")("front.time to end").toString(),e.inTournament=!0,e.tournamentInfo.registered&&(t.$on("$profile",function(){l()}),l(),s(l,5e3))):(l(),e.tournamentFinish=!0,e.countDownVal=null,e.countDownText=""))}).error(function(){}),u=!0}if(e.tournamentInfo&&(e.countDownVal=Math.floor(Math.floor(e.tournamentInfo.start_date-o)<0?e.tournamentInfo.end_date-o:e.tournamentInfo.start_date-o),e.countDownVal<=0)){if(e.inTournament)return e.inTournament=!1,e.tournamentFinish=!0,void(e.countDownVal=0);e.tournamentFinish||(e.inTournament=!0,e.countDownText=a("i18n")("front.time to end").toString(),e.countDownVal=e.tournamentInfo.end_date-o,e.tournamentInfo.registered&&(t.$on("$profile",function(){l()}),l(),s(l,5e3)),e.$apply())}})}])}(),function(){app.traderoomRouting=function(e){e.state("user.traderoom",{url:"/options",views:{"content@user":{templateUrl:getTemplate("/views/traderoom/options/binary-turbo.html"),controller:"OptionsCtrl as opt"}},"abstract":!0,onEnter:["$rootScope","$state","$http",function(e,t,n){if(1!=e.user.profile.balance_type){var o=null;if($.each(e.user.profile.balances||[],function(e,t){1==t.type&&(o=t.id)}),o){var r={method:"post",url:"api/profile/changeaccount",data:{balance_id:o}};n(r).success(function(e){e.isSuccessful||t.go("user.tournament")}).error(function(){t.go("user.tournament")})}}e.user.profile.confirm&&t.go("user.cabinet.profile.confirm")}]}).state("user.traderoom.binary",{url:"/binary?no_welcome_splash",onEnter:["$rootScope",function(e){e.optionType="binary",e.optionRangeTime=1800}]}).state("user.traderoom.binary.active",{url:"/{active}",views:{"content@user":{templateUrl:getTemplate("/views/traderoom/options/binary-turbo.html"),controller:"OptionsCtrl as opt"}}}).state("user.traderoom.turbo",{url:"/turbo?no_welcome_splash",onEnter:["$rootScope",function(e){e.optionType="turbo",e.optionRangeTime=180}]}).state("user.traderoom.turbo.active",{url:"/{active}",views:{"content@user":{templateUrl:getTemplate("/views/traderoom/options/binary-turbo.html"),controller:"OptionsCtrl as opt"}}}).state("user.traderoom-tournament",{url:"/options/tournament",views:{"content@user":{templateUrl:getTemplate("/views/traderoom/options/binary-turbo.html"),controller:"OptionsCtrl as opt"}},onEnter:["$rootScope","$http","$state","$timeout","$time",function(e,t,n,o){e.optionType="turbo",e.optionRangeTime=180;var r=!1,a=null;if(e.$on("socketEvent:timeSync",function(i,s){if(e.tournamentInfo){if(s/=1e3,!r){var c={method:"get",url:"api/tournaments/getlist"};t(c).success(function(e){e.isSuccessful&&(a=e.result[0],a.duration=a.end_date-s,a.start_date>s||a.end_date<s?n.go("user.tournament"):o(function(){n.go("user.tournament")},1e3*a.duration))}).error(function(){});var c={method:"post",url:"api/tournaments/stats",data:{tournament_id:e.tournamentInfo.id}};t(c).success(function(t){t.isSuccessful&&(e.user.tournamentPos=t.result.position)}).error(function(){}),r=!0}a&&(e.user.profile.tournamentCountDown=a.end_date-s,(e.user.profile.tournamentCountDown<=0||a.start_date>s)&&(e.user.profile.tournamentCountDown=!1))}}),2!=e.user.profile.balance_type){var i=null;if($.each(e.user.profile.balances,function(e,t){2==t.type&&(i=t.id)}),i){var s={method:"post",url:"api/profile/changeaccount",data:{balance_id:i}};t(s).success(function(e){e.isSuccessful||n.go("user.tournament")}).error(function(){n.go("user.tournament")})}else n.go("user.tournament")}}]})}}(),Highcharts.setOptions({global:{useUTC:!1}});var chartConf={chart:{backgroundColor:null,spacingTop:0,spacingRight:0,spacingLeft:0,spacingBottom:10,plotBorderWidth:0,borderColor:"#bfbfbf"},loading:{showDuration:10,hideDuration:10,labelStyle:{top:"35%",color:"#555",opacity:0},style:{background:"white url(/images/preloader.gif) no-repeat center center",backgroundSize:"50px",opacity:1}},credits:{enabled:!1},title:!1,xAxis:{title:"",showFirstLabel:!0,showLastLabel:!0,type:"datetime",labels:{overflow:"justify"}},yAxis:{title:"",gridLineDashStyle:"Dot",showFirstLabel:!1,showLastLabel:!1,opposite:!0,maxPadding:.3,tickLength:5,labels:{align:"left",y:-2,style:{}},offset:-90},tooltip:{formatter:function(){return Highcharts.dateFormat("%H:%M:%S",this.x)+": <strong>"+this.y.toFixed(6)+"</strong>"}},legend:{enabled:!1},plotOptions:{area:{fillOpacity:.7,lineWidth:1,marker:{enabled:!1},shadow:!1,states:{hover:{lineWidth:1,fillOpacity:.2}},threshold:null,enableMouseTracking:!0,cropThreshold:1e3,lineColor:"#bb5c0c",color:"#ff8201"}},series:[{type:"area",pointInterval:1e3,data:[]}]};!function(){app.filter("rateTime",function(){return memoize2.wrap(function(e){var t=moment(parseInt(e));return t.isValid()?t.format("HH:mm"):""})})}(),function(){app.filter("rateDate",["$rootScope","$filter",function(e,t){return memoize2.wrap(function(n){var o=moment(parseInt(n));return moment.lang(e.lang.current.key,{calendar:{lastDay:"["+t("i18n")("front.yesterday").toString()+"]",sameDay:"["+t("i18n")("front.today").toString()+"]",nextDay:"["+t("i18n")("front.tomorrow").toString()+"]",lastWeek:"DD.MM.YYYY",nextWeek:"DD.MM.YYYY",sameElse:"DD.MM.YYYY"}}),o.isValid()?o.calendar():""})}])}(),function(){app.filter("rateDateTime",function(){return memoize2.wrap(function(e){var t=moment(parseInt(e));return t.isValid()?t.format("DD.MM.YYYY HH:mm"):""})})}(),function(){app.filter("remain",["$sce",function(e){return memoize2.wrap(function(t,n){var o=moment.duration(t,"seconds");if(o.asSeconds()<=0)r=n;else var r=["<b>"+o.days()+"</b>"," <span>days</span> ","<b>"+o.hours()+"</b>"," <span>hrs</span> ","<b>"+o.minutes()+"</b>"," <span>min</span> ","<b>"+o.seconds()+"</b>"," <span>sec</span>"].join("");return e.trustAsHtml(r)})}])}(),function(){app.filter("countdown",["$filter",function(e){return memoize2.wrap(function(t,n){if(0>t&&(t=0,n))return e("i18n")(n).toString();var o=moment.duration(t),r="",a=o.days(),i=o.hours(),s=o.minutes(),c=o.seconds();return a>0?r=a+" days":(i=1==i.toString().length?"0"+i:i,s=1==s.toString().length?"0"+s:s,c=1==c.toString().length?"0"+c:c,r=i+":"+s+":"+c),r})}])}(),function(){app.directive("slider",function(){return{restrict:"E",template:'<div><div class="noUiSlider"></div></div>',scope:{value:"=",min:"=",max:"=",onChange:"&"},replace:!0,link:function(e,t){function n(){var n={range:[e.min-.001,e.max+.001],start:e.value,handles:1,step:1,behaviour:"tap",connect:"lower"};n.slide=function(){e.value=Math.ceil($(this).val()),e.onChange({value:e.value}),e.$apply()},t.html('<div class="noUiSlider"></div>'),t.find(".noUiSlider").noUiSlider(n)}e.$watch("min",n),e.$watch("max",n)}}})}(),function(){app.directive("traderLevel",["$http","$rootScope",function(e,t){return{restrict:"E",replace:!0,templateUrl:getTemplate("/views/common/directives/traderLevel.html"),scope:{},link:function(){t.user.profile.level={num:2,rank:"Trader expert",exp:985,nextLevelExp:5e3}}}}])}(),function(){app.directive("activesPanel",["$rootScope","$timeout","$time","$storage","$filter","$optSocket","$state",function(e,t,n,o,r,a){return{restrict:"E",replace:!0,templateUrl:getTemplate("/views/traderoom/directives/activesPanel.html"),scope:{favActives:"=",groups:"=",enabled:"=",locked:"=",schedule:"=",onSelect:"&",active:"="},link:function(n){function i(e){var t=(e||"").toLowerCase();n.findCount=0,n.favActives&&($.each(n.groups,function(e,t){t.showItems=0}),$.each(n.favActives,function(e,o){var a=r("i18n")(o.name).toString().toLowerCase();-1!=a.indexOf(t)||""==t?(o.show=!0,(o.enabled||"0"==n.showEnabled)&&n.groups[o.groupId].showItems++,s(o,t)):o.show=!1,n.findCount++}))}function s(e,t){if(e.title=e.titleSource,t){t=t.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var n=new RegExp(t,"i");e.title=e.titleSource.replace(n,'<span class="match">$&</span>')}}function c(){n.remainOffset+=1,l=t(c,1e3)}n.showPanel=!1,n.findCount=0,n.searchText="",n.showEnabled="0",n.groupModes=[],o.get("activesShowEnabled")&&(n.showEnabled=0);var l=0;n.selectActive=function(e,t){t.enabled&&!n.locked[t.value]&&(n.onSelect({$event:e,active:t}),n.showPanel=!1,n.searchText="")},n.toggle=function(){n.showPanel=!n.showPanel,$.each(n.groups,function(e,t){t.countItems=t.showItems,n.groupModes[e]="short"})},$("body").click(function(e){0==$(e.target).parents(".all-actives").length&&(n.showPanel=!1,n.searchText="",n.$apply())}),n.$watch("showPanel",function(e){e&&$(".highcharts-container").one("click",function(){n.showPanel=!1,n.searchText="",n.$apply()})}),n.changeEnabled=function(e){o.set("activesShowEnabled","1"==e?1:0),i(n.searchText)};var u=!1;n.viewMode=function(o,r,i){if("remain"==i&&u!=e.optionType?$(o.target).addClass("disabled-link"):n.groupModes[r]=i,u!=e.optionType){var s=[];$.each(n.favActives,function(e,t){s.push(t.value)}),a.emit("getSchedule",{type:e.optionType,ids:s});var p=e.$on("socketEvent:schedule",function(o,a){n.groupModes[r]=i,p(),$.each(n.favActives,function(e,t){a[t.value]&&(t.remainToOpen=a[t.value].time_to_open,t.remainToClose=a[t.value].time_to_close)}),n.remainOffset=0,t.cancel(l),c(),u=e.optionType})}},n.$watch("searchText",i)}}}])}(),function(){app.directive("chart",["$rootScope","$filter","$timeout","$interval","$time",function(e,t,n,o,r){return{restrict:"E",replace:!0,templateUrl:getTemplate("/views/traderoom/directives/chart.html"),scope:{config:"=",active:"=",onLoad:"&",rangeTime:"="},link:function(o,a){function i(e,t){var n=b.xAxis[0].toPixels(e),o=b.yAxis[0].toPixels(t),r={x:Math.round(n),y:Math.round(o)};return r}function s(){if(0==b.series[0].data.length)return!1;var e=b.series[0].data[b.series[0].data.length-1];return i(e.x,e.y)}function c(e,t,n,o){return o=o||_,["M",n,e.y,"L",n+o.w/2,e.y+o.h*-x[t],n+o.w,e.y]}function l(e){return[b.plotLeft,e.y,b.plotWidth,1,0]}function u(e){return{x:b.plotLeft+e.x,y:b.plotTop+e.y}}function p(e,t){return"put"==t?[b.plotLeft,e.y,b.plotWidth,b.plotTop+b.plotHeight-e.y,0]:[b.plotLeft,b.plotTop,b.plotWidth,e.y-b.plotTop,0]}function d(e){var t=-1;if(!o.active||!o.active.data)return!1;t=o.active.data.value;var n=!1;return"put"==e.dir&&t<e.value?(void 0==e.inZone||e.inZone||o.$emit("chart:sound",!0),e.inZone=!0,n=!0):"call"==e.dir&&t>e.value?(void 0==e.inZone||e.inZone||o.$emit("chart:sound",!0),e.inZone=!0,n=!0):(void 0!=e.inZone&&e.inZone&&o.$emit("chart:sound",!1),e.inZone=!1),n}function f(e,t){"y"==t.prop&&(t.now=Math.round(t.now))}function m(e){S.textCourse.element.textContent=o.active.data.show_value||"";var t=S.textCourse.element.getBBox(),n=t.width,r=t.height;S.w=n+2*S.textMarginW,S.h=r+2*S.textMarginH,S.x=b.plotWidth-96,S.lineBeforeRect={x:0,y:e.y,width:S.x,height:1},S.lineAfterRect={x:S.x+S.w,y:e.y,width:b.plotWidth-S.x-S.w,height:1},S.textXY={x:S.x+S.arrW+S.textMarginW,y:e.y+r/4+1}}function h(e,t,n,o,r){return["M",o,r,"l",n,-t/2,"h",e,"v",t,"h",-e,"l",-n,-t/2,"z"]}function g(t){var r=e.optionAchtungTime,a=!1,i=!1;P.value-t<=r&&!a?(o.achtungTime=!0,a=!0,n(function(){},P.value-t)):o.achtungTime=!1,I.value-t<=r&&!i&&(i=!0,n(function(){},I.value-t))}function v(e){b=e,o.onLoad({chart:e}),o.resize(),o.showLoading()}var b,y={},w=null,S=null,k={call:"#68a84f",put:"#bc4b3b"},x={call:1,put:-1},_={w:40,h:22},C=!1,T=null,D=[],S={w:0,h:0,x:0,arrW:10,textMarginW:4,textMarginH:2,barMarginRight:30,color:"rgba(10,10,10,1)",lineColor:"rgba(0,0,0,.3)"},A=!1,M=!1,P={},I={};o.achtungTime=!1,e.chartHeightOffset=e.chartHeightOffset||62,o.resize=function(t){var n=$(".actives-panel").width()+2,r=Math.round(a.parent().height()-e.chartHeightOffset-(2==e.user.profile.balance_type?e.chartHeightOffset:0));b.setSize(n,r,t),o.redraw()},$(window).resize(function(){o.resize(!0)}),o.redraw=function(){o.drawCurrentPoint(),o.drawBarometr(),o.drawDirection(),o.drawRates(),o.drawLines(),o.drawFeed()},o.$on("chart:feedActive",function(e,t){A&&A.g&&(A.g.destroy(),A.g=null,A=!1),t&&(A=t,A.createdSite=r.convert(A.f.created)),o.drawFeed()}),o.$on("chart:feed",function(e,t){M&&M.g&&(M.g.destroy(),M.g=null,M=!1),t&&(M=t,M.createdSite=r.convert(M.f.created)),o.drawFeed()}),o.drawLines=function(){if(P.g){var e=Math.round(b.xAxis[0].toPixels(P.value)),n=b.plotHeight-30;P.line.attr({d:["M",e,0,"v",b.plotHeight]}),P.text.attr({x:-n,y:e-5})}else if(P.value){var e=Math.round(b.xAxis[0].toPixels(P.value)),n=b.plotHeight-30;P.g=b.renderer.g().attr({zIndex:5}).add(),P.line=b.renderer.path(["M",e,0,"v",b.plotHeight]).attr({stroke:"#ff531c","stroke-width":1,"stroke-dasharray":"1,3"}).add(P.g),P.text=b.renderer.text(t("i18n")("front.deadline_investment"),0,0).attr({transform:"rotate(-90)"}).css({color:"#ff531c",fontSize:"12px","font-family":"Arial"}).add(P.g)}if(I.g){var e=Math.round(b.xAxis[0].toPixels(I.value)),n=b.plotHeight-10;I.line.attr({d:["M",e,0,"v",b.plotHeight]}),I.text.attr({x:-n,y:e-5})}else if(I.value){var e=Math.round(b.xAxis[0].toPixels(I.value)),n=b.plotHeight-10;I.g=b.renderer.g().attr({zIndex:5}).add(),I.line=b.renderer.path(["M",e,0,"v",b.plotHeight]).attr({stroke:"#000","stroke-width":1,"stroke-dasharray":"1,3"}).add(I.g),I.text=b.renderer.text(t("i18n")("front.closing rate"),0,0).attr({transform:"rotate(-90)"}).css({color:"#000",fontSize:"12px","font-family":"Arial"}).add(I.g)}},o.$on("$changeLang",function(){P.text.element.textContent=t("i18n")("front.deadline_investment"),I.text.element.textContent=t("i18n")("front.closing rate")}),o.drawDirection=function(){if(C){var e=s(),t=b.plotLeft+b.plotWidth/2-_.w/2;if(T){T.triangle.animate({d:c(e,C,t)});var n=p(e,C);T.area.animate({y:n[1],height:n[3]})}else T={},T.g=b.renderer.g().attr({zIndex:99}).add(),T.area=b.renderer.rect.apply(b.renderer,p(e,C)).attr({fill:"rgba(255,255,255,.4)"}).add(T.g),T.triangle=b.renderer.path(c(e,C,t)).attr({fill:k[C]}).add(T.g)}else T&&(T.g.destroy(),T=null)},o.$on("chart:deadTime",function(e,t,n,r){var a=t-n;o.countdown=a;var i=b.xAxis[0].getExtremes().max,s=b.xAxis[0].toPixels(i),c=b.xAxis[0].toPixels(t),l=200;if(i&&s&&c&&l){if(c>s-l){var u=t-(b.xAxis[0].toValue(b.xAxis[0].toPixels(t+1e3*o.rangeTime)-l)-t),p=u-1e3*o.rangeTime,d=u+1e3*o.rangeTime,f=b.series[0].data[b.series[0].data.length-1];f.x>p&&b.xAxis[0].setExtremes(p,d,!0,{duration:1e3})}o.isBuy=r,P.value=a,I.value=t,o.drawLines()}}),o.$on("chart:destroy",function(){b&&(b.destroy(),a.find(".chart").html("").highcharts(o.config,o.onLoadChart))}),o.$on("chart:redraw",function(e,t){o.resize(void 0==t?!0:t)}),o.$on("chart:showDir",function(e,t){C=t,S.g&&(S.path.attr("fill",k[C]),S.lineBefore.attr("fill",k[C]),S.lineAfter.attr("fill",k[C])),o.drawDirection()}),o.$on("chart:hideDir",function(){S.g&&(S.path.attr("fill",S.color),S.lineBefore.attr("fill",S.lineColor),S.lineAfter.attr("fill",S.lineColor)),C=!1,o.drawDirection()}),o.$on("chart:setRates",function(e,t){o.removeRates(),$.each(t,function(e,t){delete t.inZone,D.push(t)}),o.removeBarometr(),o.drawRates()}),o.$on("chart:removeRates",function(){o.removeRates(),o.removeBarometr()}),o.removeRates=function(){$.each(D,function(e,t){t.g&&(t.g.destroy(),t.g=null)}),D=[]},o.drawRates=function(){var n=10,o=20;$.each(D,function(r,a){var s=i(a.expSite,a.value),p=b.plotLeft+10+r*(_.w+15),f="put"==a.dir?8:0,m=i(a.createdSite,a.value),h=u(m),g=d(a);if(a.g)a.line.animate({width:b.plotWidth,y:s.y}),a.triangle.animate({d:c(s,a.dir,p)}),a.line.css({opacity:g?1:.5}),a.triangle.css({opacity:g?1:.5}),a.point.animate({x:h.x,y:h.y}),a.textExp.animate({y:s.y+f+n*x[a.dir]}),a.textSum.animate({y:s.y+f+o*x[a.dir]});else{a.g=b.renderer.g().attr({zIndex:50}).add(),a.line=b.renderer.rect.apply(b.renderer,l(s)).attr({fill:k[a.dir],opacity:g?1:.5}).add(a.g),a.triangle=b.renderer.path(c(s,a.dir,p)).attr({fill:k[a.dir],opacity:g?1:.5,zIndex:2e3}).add(a.g),a.point=b.renderer.circle(h.x,h.y,3).attr({fill:k[a.dir],zIndex:50}).add(a.g),a.textExp=b.renderer.text(a.value.toString(),p,s.y+f+n*x[a.dir]).css({color:k[a.dir],fontSize:"10px"}).add(a.g);var v=e.user.profile.currency.toLowerCase(),$=t("money")(a.sum,2,"",!0);"rub"==v||4==v?$+="Р":("usd"==v||5==v)&&($="$ "+$),a.textSum=b.renderer.text($,p+_.w/2,s.y+f+o*x[a.dir]).css({"text-anchor":"middle",color:k[a.dir],fontSize:"10px"}).add(a.g)}})},o.drawFeed=function(){o._drawFeed(M,.6),o._drawFeed(A,1)},o._drawFeed=function(e,t){if(e){var n=i(e.createdSite,e.value),o={call:2,put:-2},r="rgba(0, 132, 255, "+t+")";e.g?(e.line.animate({width:b.plotWidth,y:n.y}),e.point.animate({x:n.x,y:n.y}),e.triangle.animate({d:c({x:n.x,y:n.y+o[e.dir]},e.dir,n.x-5,{w:10,h:6})})):(e.g=b.renderer.g().attr({zIndex:50}).add(),e.line=b.renderer.rect.apply(b.renderer,l(n)).attr({fill:r}).add(e.g),e.point=b.renderer.circle(n.x,n.y,8).attr({stroke:r,"stroke-width":1,fill:"#fff",zIndex:50}).add(e.g),e.triangle=b.renderer.path(c({x:n.x,y:n.y+o[e.dir]},e.dir,n.x-5,{w:10,h:6})).attr({fill:r,zIndex:120}).add(e.g))}},o.drawCurrentPoint=function(){var e=s();!e||isNaN(e.x)||isNaN(e.y)||(w||(w=b.renderer.circle(e.x,e.y,3).attr({fill:"#5a8a00","class":"current-point",zIndex:102}).add()),w.animate({cx:e.x,cy:e.y}))},o.removeBarometr=function(){S.g&&(S.g.destroy(),S.g=!1)},o.drawBarometr=function(e){var t=s();if(t&&!isNaN(t.x)&&!isNaN(t.y)&&o.active.data)if(S.g)m(t),e?(S.lineBefore.attr({y:S.lineBeforeRect.y}),S.lineAfter.attr({y:S.lineAfterRect}),S.path.attr({d:h(S.w,S.h,S.arrW,S.x,t.y)}),S.textCourse.attr({x:S.textXY.x,y:S.textXY.y})):(S.lineBefore.animate(S.lineBeforeRect,{step:f}),S.lineAfter.animate(S.lineAfterRect,{step:f}),S.path.animate({d:h(S.w,S.h,S.arrW,S.x,t.y)}),S.textCourse.animate(S.textXY,{step:f}));else{S.g=b.renderer.g().attr({zIndex:100}).add();var n=o.active.data.show_value;S.textCourse=b.renderer.text(n,0,0).attr({zIndex:100}).css({color:"#fff",fontSize:"11px"}).add(S.g),m(t);var r=S.lineBeforeRect;S.lineBefore=b.renderer.rect(r.x,r.y,r.width,r.height).attr({fill:S.lineColor}).add(S.g),r=S.lineAfterRect,S.lineAfter=b.renderer.rect(r.x,r.y,r.width,r.height).attr({fill:S.lineColor}).add(S.g),S.path=b.renderer.path(h(S.w,S.h,S.arrW,S.x,t.y)).attr({fill:S.color}).add(S.g),S.textCourse.attr({x:S.textXY.x,y:S.textXY.y})}},o.$on("chart:data",function(e,t,r){if(t.length>1){y={};for(var a=0;a<t.length;a++)c=t[a][0],l=t[a][1],y[c]=[l,a];var i=t[t.length-1];r&&b.xAxis[0].setExtremes(i[0]-1e3*o.rangeTime,i[0]+1e3*o.rangeTime),b.series[0].setData(t,!0,!1,!0),o.drawBarometr(!0),n(function(){o.hideLoading()},300)}else{var s=t[0],c=s[0],l=s[1];if(g(c),y[c]){var u=y[c][1];y[c]=[l,u];try{b.series[0].data[u].update(l)}catch(p){console.log(b.series[0].data,u,y)}}else{b.series[0].addPoint(s);var u=b.series[0].data.length-1;y[c]=[l,u],r&&c>b.xAxis[0].getExtremes().max-100*o.rangeTime&&b.xAxis[0].setExtremes(c-1e3*o.rangeTime,c+1e3*o.rangeTime,!0,!0)}}o.redraw(),o.$apply()}),o.showLoading=function(){b.showLoading(),a.find(".info").animate({opacity:0},chartConf.loading.showDuration)},o.hideLoading=function(){b.hideLoading(),a.find(".info").animate({opacity:1},chartConf.loading.hideDuration),o.resize(!1)},o.$on("chart:showLoading",function(){o.showLoading()}),o.$on("chart:hideLoading",function(){o.hideLoading()}),a.find(".chart").highcharts(chartConf,v)}}}])}(),function(){app.directive("myChart",["$compile","$timeout","$filter","$time",function(e,t,n){return{restrict:"E",template:'<div class="chart-container"><canvas width="1000" height="400" class="my-chart"></canvas><div class="controls"><button id="zoomChartIn" class="btn btn-large">+</button><button id="zoomChartOut" class="btn btn-large">-</button><br><button id="moveChartLeft" class="btn btn-large"><-</button><button id="moveChartRight" class="btn btn-large">-></button><br><button id="addObjY" class="btn btn-large">+Y</button><button id="delObjY" class="btn btn-large">XY</button><br><button id="addObjX" class="btn btn-large">+X</button><button id="delObjX" class="btn btn-large">XX</button><br><div class="btn-group" data-toggle="buttons"><label class="btn btn-primary" id="TICK"><input type="radio" name="timeFrame">tick</label><label class="btn btn-primary" id="M1"><input type="radio" name="timeFrame">M1</label><label class="btn btn-primary" id="M5"><input type="radio" name="timeFrame">M5</label><label class="btn btn-primary" id="M15"><input type="radio" name="timeFrame">M15</label></div></div></div>',scope:{chartObj:"=chart",onLoad:"&"},transclude:!1,replace:!0,link:function(e,t){e.onLoad({chart:chart}),e.$on("chart:data",function(n,o){if(o.length>1){for(var r=[],a=0;a<o.length;a++)s=o[a][0],c=o[a][1],r[r.length]={rate:c,time:s};null==chart.ctx?chart.create(t.find(".my-chart"),r):(chart.points=[],chart.addPoints(r,!0))}else{var i=o[0],s=i[0],c=i[1];chart.addPoints([{time:s,rate:c}],!1)}e.$digest()});var o=[];e.$on("chart:deadTime",function(t,r,a,i){var s=r-a;e.countdown=i?r:s,o.length?(o[0].time=r,o[1].time=s):(o[0]=chart.addObject(function(e,t,o,r){t=Math.floor(t),e.font="12px Arial",e.rotate(1.5*Math.PI),e.beginPath(),e.moveTo(chart.marginBottom-e.canvas.height,t),e.lineTo(e.canvas.height,t),e.lineWidth=1,e.strokeStyle="rgba(36, 63, 36, "+r+")",e.save(),e.setLineDash([1,3]),e.stroke(),e.restore(),e.fillStyle="rgba( 0, 0, 0, "+r+" )",e.fillText(n("i18n")("front.time_of_expiry").toString(),chart.marginBottom-e.canvas.height+10,t-5)},r,null,!1,!0),o[1]=chart.addObject(function(e,t,o,r){e.font="12px Arial",e.rotate(1.5*Math.PI),e.beginPath(),e.moveTo(chart.marginBottom-e.canvas.height,t),e.lineTo(e.canvas.height,t),e.lineWidth=1,e.strokeStyle="rgba( 255, 83, 28, "+r+")",e.save(),e.setLineDash([1,3]),e.stroke(),e.restore(),e.fillStyle="rgba( 255, 83, 28, "+r+" )",e.fillText(n("i18n")("front.deadline_investment").toString(),chart.marginBottom-e.canvas.height+20,t-5)},s,null,!1,!0))});var r=null;e.$on("chart:showDir",function(e,t){delete r,r=chart.addObject(function(e,n,o,r){o=chart.currentPoint.y;var a={dir:-1,color:"rgba( 43, 139, 58, "+r+" )"};e.fillStyle="rgba( 255, 255, 255, "+.4*r+" )","put"==t?(e.fillRect(0,o+1*a.dir,e.canvas.width,e.canvas.height-chart.marginBottom-o+1*a.dir),a={dir:1,color:"rgba( 193, 55, 38, "+r+" )"}):e.fillRect(0,0,e.canvas.width,o+1*a.dir),e.beginPath(),e.moveTo(0,o+1*a.dir);var i=Math.floor(e.canvas.width/2);e.lineTo(i-20,o+1*a.dir),e.lineTo(i,o+22*a.dir),e.lineTo(i+20,o+1*a.dir),e.lineTo(e.canvas.width,o+1*a.dir),e.lineTo(e.canvas.width,o),e.lineTo(0,o),e.fillStyle=a.color,e.fill()},null,null,!1,!0)}),e.$on("chart:hideDir",function(){chart.delObject(r)});var a={};e.$on("chart:setRates",function(e,t){chart.delObject(r);var n=[];$.each(t,function(e,t){delete t.inZone,n[n.length]=t.created,a[t.created]||(a[t.created]=chart.addObject(function(n,o,r,a){o=Math.floor(o),r=Math.floor(r);var i={dir:-1,color:"rgba( 43, 139, 58, "+a+" )"};"put"==t.dir&&(i={dir:1,color:"rgba( 193, 55, 38, "+a+" )"}),n.beginPath(),n.arc(o,r,3,0,2*Math.PI,!1),n.fillStyle=i.color,n.fill(),n.closePath(),n.beginPath(),n.moveTo(0,r+1*i.dir),n.lineTo(45*e+10,r+1*i.dir),n.lineTo(45*e+30,r+22*i.dir),n.lineTo(45*e+50,r+1*i.dir),n.lineTo(n.canvas.width,r+1*i.dir),n.lineTo(n.canvas.width,r),n.lineTo(0,r),n.fill()},1e3*t.created,t.value,!1,!0))}),$.each(a,function(e,t){-1==$.inArray(parseInt(e),n)&&(chart.delObject(t),delete a[e])})}),e.$on("chart:removeRates",function(){$.each(a,function(e,t){chart.delObject(t),delete a[e]})});var i,s;$("#addObjY").click(function(){i=chart.addObject(function(e,t,n,o){e.beginPath(),e.moveTo(0,n),e.lineTo(0,n+2),e.lineTo(705,n+2),e.lineTo(730,n+32),e.lineTo(755,n+2),e.lineTo(755,n),e.fillStyle="rgba( 255, 0, 0, "+o+" )",e.fill(),e.closePath()},null,4.6542,!0,!0)}),$("#addObjX").click(function(){s=chart.addObject(function(e,t,n,o){e.beginPath(),e.arc(t,150,20,0,2*Math.PI,!1),e.fillStyle="rgba( 255, 0, 0, "+o+" )",e.fill(),e.closePath()},3e5,null,!1,!0)}),$("#zoomChartIn").click(function(){chart.setNewConfig({pointWidth:chart.pointWidth+1})}),$("#zoomChartOut").click(function(){chart.pointWidth>4&&chart.setNewConfig({pointWidth:chart.pointWidth-1})}),$("#moveChartRight").click(function(){chart.setNewConfig({padding:[chart.padding[0],chart.padding[1]-5*chart.pointWidth,chart.padding[2],chart.padding[3]]})}),$("#moveChartLeft").click(function(){chart.setNewConfig({padding:[chart.padding[0],chart.padding[1]+5*chart.pointWidth,chart.padding[2],chart.padding[3]]})}),$("#delObjY").click(function(){chart.delObject(i)}),$("#delObjX").click(function(){chart.delObject(s)}),$("#M1").click(function(){chart.timeInterval=2e3}),$("#TICK").click(function(){chart.timeInterval=1e3})}}}])}(),function(){app.directive("balanceAnimator",["$filter","$timeout","$rootScope",function(e,t,n){return{restrict:"A",scope:{value:"=",filters:"@",output:"="},link:function(t,o){function r(r,a){var i=(t.value,{val:a}),s=o.css("color");n.user.profile.demo||o.css("color","#26de43"),TweenMax.to(o,.08,{transformOrigin:"center center",scale:1.05}),TweenMax.to(i,1,{val:r,ease:Circ.easeOut,onUpdate:function(){t.output=e(t.filters)(i.val),t.$apply()},onComplete:function(){TweenMax.to(o,.1,{color:s,scale:1,transformOrigin:"center center",delay:.1})}})}t.output=e(t.filters)(t.value),t.$on("socketEvent:profile",function(){t.output=e(t.filters)(t.value)}),t.$watch("value",function(n,o){n!=o&&n>o?r(n,o):t.output=e(t.filters)(t.value)})}}}])}(),function(){app.directive("lock",["$rootScope","$timeout","$time","$storage","$filter","$optSocket","$state","$popup",function(e,t,n,o,r,a,i,s){return{restrict:"A",scope:{lock:"=",lockPlacement:"=",lockType:"="},link:function(n,o){function c(e,t,n,o){e.each(function(){for(var e=1*$(this).css("left").replace("px",""),r=1;t>=r;r++)$(this).animate({left:e+-1*n},o/t/4).animate({left:e+n},o/t/2).animate({left:e},o/t/4)})}function l(t){a.emit("getSchedule",{type:e.optionType,ids:[t]});var n=e.$on("socketEvent:schedule",function(e,o){n(),p.content=o[t]?r("i18n")("front.active is open").toString()+" "+moment((new Date).getTime()+1e3*o[t].time_to_open).fromNow().toString().replace(/^\S*\s/,""):r("i18n")("front.active is disabled").toString()})}if(n.lock){o.addClass("lock"),o.append("time"==n.lockType?'<i class="fa fa-clock-o lock-ico ml5"></i>':'<i class="fa fa-lock lock-ico"></i>');var u='<div class="popover popover-dark lock-popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content text-center"><p></p></div></div></div>',p={template:u,html:!0,container:"body",placement:n.lockPlacement||"auto left",trigger:"manual"},d={p:null};o.mouseleave(function(){t.cancel(d.p),d.p=t(function(){o.popover("destroy")},500)}).find(".lock-ico").mouseenter(function(){"time"==n.lockType?l(n.lock):p.content=n.lock+'<br><button class="btn btn-sm btn-success mt10 mb5 unlock"><i class="fa fa-unlock-alt mr5"></i> '+r("i18n")("front.unlock").toString()+"</button>",$(".lock").popover("destroy"),t.cancel(d.p),d.p=t(function(){o&&o.popover(p).popover("show")},300)}),o.click(function(){t.cancel(d.p);var e=$(".lock-popover");"block"==e.css("display")?c(e,2,5,300):("time"==n.lockType?l(n.lock):p.content=n.lock+'<br><button class="btn btn-sm btn-success mt10 mb5 unlock"><i class="fa fa-unlock-alt mr5"></i> '+r("i18n")("front.unlock").toString()+"</button>",d.p=t(function(){o&&o.popover(p).popover("show"),c(e,2,5,200)},300))}),$(document).on("mouseenter",".lock-popover",function(){t.cancel(d.p)}).on("mouseleave",".lock-popover",function(){d.p=t(function(){o.popover("destroy")},500)}),n.lockType||$(document).on("click",".unlock",function(t){t.preventDefault(),o.popover("destroy"),e.user.profile.trial?s.all().register||s.register(0):i.go("user.cabinet.counting.features")}),n.$on("$changeLang",function(){t(function(){"time"==n.lockType?l(n.lock):p.content=n.lock+'<br><button class="btn btn-sm btn-success mt10 mb5 unlock"><i class="fa fa-unlock-alt mr5"></i> '+r("i18n")("front.unlock").toString()+"</button>"})}),n.$on("$destroy",function(){$(document).off("click",".unlock").off("mouseenter",".lock-popover").off("mouseleave",".lock-popover"),t.cancel(d.p),$(".lock-popover").remove()})}}}}])}(),function(){app.controller("OptionsCtrl",["$scope","$http","$location","$optSocket","$stateParams","$rootScope","$timeout","$storage","$filter","$time","$popup","$interval","$q","$state",function(e,t,n,o,r,a,i,s,c,l,u,p,d){function f(){A.initData&&(A.maxDeposit=Math.min(A.initData.result.maximal_bet,a.user.profile.balance),(A.maxDeposit<A.active.min||A.maxDeposit>A.active.max)&&(A.maxDeposit=-1))}function m(){j&&(i.cancel(j),i.cancel(R)),j=i(function(){h()},300)}function h(){O=$.Deferred(),A.chart&&e.$broadcast("chart:showLoading"),$.when(U,O).done(function(){n.search().no_welcome_splash||a.user.profile.welcome_splash||!a.user.profile.demo?A.init(a.optionType,A.initData):(u.closeAll(),u.show({templateUrl:"/views/traderoom/popups/study/popup.step1.html",backdrop:!0,backdropClass:"backgrop-dark",scopeLocals:{nextStep:e.nextStep,finishStudy:e.finishStudy}}))
}),A.rangeTime=a.optionRangeTime;var o={method:"get",url:"/api/option/init?type="+a.optionType};t(o).success(function(e){e.isSuccessful&&(A.initData=e,O.resolve())})}function g(){var e=A.settings();e&&(e.return=e.return||0,A.data.returnPercent=e.return<A.data.refund_min?A.data.refund_min:e.return>A.data.refund_max?A.data.refund_max:e.return)}function v(){A.activesObj={},A.groups=[],A.favoriteActives=[],$.each(A.actives,function(e,t){A.groups.push({name:e,availableItems:0,showItems:0}),$.each(t,function(e,t){A.activesObj[t.value]=t,t.favCount=0,t.enabled=A.activesEnabled[t.value],t.locked=A.activesLocked[t.value],t.min=A.activesMinMax[t.value].min,t.max=A.activesMinMax[t.value].max,t.groupId=A.groups.length-1,t.show=!0,t.titleSource=c("i18n")(t.name).toString(),t.title=t.titleSource;var n=A.initData.result.option[t.value].profit;t.profitPercent=100-n.commission-n.refund_min,A.groups[A.groups.length-1].showItems++,t.enabled&&A.groups[A.groups.length-1].availableItems++,A.favoriteActives.push(t)})})}function b(){$.each(A.favoriteActives,function(e,t){return t.enabled&&!t.locked?(A._selectActive(t.value,!0),!1):void 0})}function y(){A.storageFavActives={};var e=s.get(a.optionType+".favActives");e&&(A.storageFavActives=e,$.each(e,function(e,t){A.activesObj[e]&&(A.activesObj[e].favCount=t)})),A.favoriteActives.sort(function(e,t){switch(!0){case e.enabled&&!e.locked&&t.enabled&&!t.locked||e.enabled&&e.locked&&t.enabled&&t.locked||!e.enabled&&e.locked&&!t.enabled&&t.locked:return A.activesObj[t.value].favCount-A.activesObj[e.value].favCount;case!e.enabled||!e.enabled&&e.locked&&!t.enabled||e.enabled&&e.locked&&t.enabled:return 1;default:return-1}})}function w(e,t){return e+"_"+t}function S(e,t,n){A.rates[e]=A.rates[e]||{key:e,exp:t.expired,expSite:t.expSite,active:t.active,activeId:t.active_id,profit:0,deposit:0,game_state:n?1:0,old:n,list:[],created:t.created,createdSite:l.convert(t.created)}}function k(e,t){var n="",o="";t=t||!1,$.each(e,function(e,r){return r.type_name&&r.type_name!=A.type?!1:(r.createdSite=l.convert(r.created),r.expSite=l.convert(r.expired),n=w(r.expSite,r.active_id),S(n,r,t),n!=o&&(A.rates[n].list=[],t||(A.rates[n].profit=0,A.rates[n].deposit=0)),o=n,0==A.rates[n].game_state&&(A.rates[n].game_state=r.game_state),A.rates[n].list.push(r),A.rates[n].deposit+=r.sum,A.rates[n].profit+=r.profit_amount,void(A.rates[n].diff=A.rates[n].profit-A.rates[n].deposit))}),$.each(A.rates,function(e,t){if(1==t.game_state&&!t.finish&&!t.old){if(t.finish=!0,t.bounce=!0,t.activeId==A.active.value){var n=0,o=0;$.each(t.list,function(e,t){n+=t.sum,o+=t.profit_amount});var r=o-n,i=r>=0;a.sound&&(i?A.sounds.gameWin.play():A.sounds.gameLose.play())}A.ratesKey==e&&(A.currentPanel="buyOptionFinish",_())}}),x()}function x(){A.ratesOpened=[],A.ratesClosed=[],$.each(A.rates,function(e,t){t.old||1==t.game_state?A.ratesClosed.push(t):A.ratesOpened.push(t)}),a.options&&$.each(a.options.types,function(e,t){t.name==A.type&&(t.count=A.ratesOpened.length)})}function _(){function e(e){var t={active:e.result.active,expiredSite:l.convert(e.result.expired),exp_value:e.result.exp_value,rates:e.result.data},o=0,r=0;$.each(e.result.data,function(e,t){r+=t.deposit,o+=t.profit}),t.deposit=r,t.profit=o,t.diff=o-r,t.win=t.diff>=0,t.hideFinishPopup=A.hideFinishPopup,t.newRate=A.newRateFinish,A.game=t,n.old||(n.showFinishPopup=!0,n.popup=u.show({templateUrl:"/views/traderoom/popups/popup.finish.html",backdrop:!0,backdropClass:"backgrop-dark",backdropClick:t.hideFinishPopup,scopeLocals:{opt:{game:t}}})),i.cancel(a),$(".popup-finish-inline").removeClass("preloader")}var n=A.rates[A.ratesKey],o=[];n.old?$.each(n.id,function(e,t){o.push(t)}):$.each(n.list,function(e,t){o.push(t.id)}),n.bounce=!1;var r={method:"post",url:"/api/game/getinfo",data:{id:o}},a=0;n.old&&(r.url="/api/game/betinfo",$(".popup-finish-inline").removeClass("preloader").addClass("preloader")),n.gameData?e(n.gameData):t(r).success(function(t){n.gameData=t,t.isSuccessful?e(t):A.simplePopup(c("i18n")("front.error get orders data").toString(),t.message[0])})}function C(){$.each(A.timesProfit,function(e,t){A.activesObj[e]&&(A.activesObj[e].profitPercent=100-t.profit.commission-t.profit.refund_min)});var e=A.timesProfit[A.active.value].bet_close_time;if($.extend(A.data,A.timesProfit[A.active.value].profit),A.data.returnPercent<A.data.refund_min||A.data.returnPercent>A.data.refund_max||A.data.returnPercent%1!==0?A.data.returnPercent=A.data.refund_min:g(),A.times=[],A.timesValue={},$.each(e,function(e,t){var n=l.convert(e),o=t.title?c("i18n")(t.title).toString():c("date")(n,"HH:mm"),t={enabled:t.enabled,value:n,time:e,title:o};A.times.push(t),A.timesValue[n]=t}),A.lastActive){A.lastActive.expTime=A.times[0].value;var t=A.lastActive.expTime-1e3*A.initData.result.defaults.deadtime;A.lastActive.buyExpire=t}if(A.ratesKey){var n=(l.getSiteTime(),A.rates[A.ratesKey]),t=n.expSite-1e3*A.initData.result.defaults.deadtime;A.data.buyTime=t,A.data.expTime=n.expSite,A.selectTime(n.expSite,!0),T()}else{var o=!1;$.each(A.times,function(e,t){t.value==A.data.expTime&&(o=!0)}),o||(A.data.expTime=A.times[0].value),A.isBuying||(A.currentPanel="buyOption");var t=A.data.expTime-1e3*A.initData.result.defaults.deadtime;A.data.buyTime=t,A.selectTime(A.data.expTime,!1)}}function T(){var e=l.getSiteTime(),t=A.rates[A.ratesKey],n=t.expSite-1e3*A.initData.result.defaults.deadtime;e>n?(A.currentPanel=t.old?"buyOptionFinishOld":t.finish?"buyOptionFinish":"buyOptionExpire",A.isBuying=!1,A.hideDir()):A.isBuying||(A.currentPanel="buyOption")}function D(){B&&B(),q&&q(),N&&N(),H&&H(),V&&V(),W&&W()}var A=this,M=a.$watch("optionType",m);e.nextStep=function(t){u.closeAll(),u.show({templateUrl:"/views/traderoom/popups/study/popup."+t+".html",backdrop:!0,backdropClass:"backgrop-dark",scopeLocals:{nextStep:e.nextStep,finishStudy:e.finishStudy}})},a.$on("socketEvent:profile",function(){f()}),e.finishStudy=function(){u.closeAll(),t({method:"post",url:"/api/set-welcome-splash"}).success(function(){}),A.init(a.optionType,A.initData)};var P=a.$on("socketEvent:connect",function(){a.user.isAuth&&o.emit("setActives",{actives:[A.active.value.toString()]})});A.currentPanel="buyOption",A.data={refund_min:0,refund_max:100,returnPercent:0,returnMoney:0,profitMoney:0};var I=-1,L=-1;A.initData=null;var O,E=null,Y=null,U=$.Deferred(),F=!1,j=!1,R=!1,z=d.defer();A.initPromise=z.promise,A.lastActive=!1,A.isBuying=!1,A.achtungTime=!1,a.optionAchtungTime=1e4,buzz.isSupported()&&(A.sounds={win:new buzz.sound("/sounds/win",{formats:["ogg","mp3"],preload:!0}),lose:new buzz.sound("/sounds/lose",{formats:["ogg","mp3"],preload:!0}),gameWin:new buzz.sound("/sounds/game_win",{formats:["ogg","mp3"],preload:!0}),gameLose:new buzz.sound("/sounds/game_lose",{formats:["ogg","mp3"],preload:!0})}),e.$on("chart:sound",function(e,t){!a.sound||A.rates[A.ratesKey].finish||A.rates[A.ratesKey].old||(t?A.sounds.win.play():A.sounds.lose.play())});var B,q,N,H,V,W;A.feed=[],A.feedOpen=0==s.get("traderoomFeed")?!1:!0,A.feedActive=!1,A.feedOver=!1,A.showFeed=$.cookie("feed")?!0:!1;var K=0;A.toggleFeed=function(e){A.feedOpen=void 0==e?!A.feedOpen:e,s.set("traderoomFeed",A.feedOpen?1:0),A.feedOpen?($(".traderoom-feed").css({height:"110px"}),a.chartHeightOffset=62):($(".traderoom-feed").css({height:"34px"}),a.chartHeightOffset=-14),a.$broadcast("chart:redraw")},A.selectFeed=function(t){A.feedActive==t?(A.feedActive=!1,e.$broadcast("chart:feedActive",!1)):(A.feedActive=t,e.$broadcast("chart:feedActive",t),A.feedActive==A.feedOver&&(A.feedOver=!1,e.$broadcast("chart:feed",!1)))},A.clearFeeds=function(){A.feedActive=!1,e.$broadcast("chart:feedActive",!1),A.feedOver=!1,e.$broadcast("chart:feed",!1)},A.overFeed=function(t){return i.cancel(K),A.feedOver==t?!1:(A.feedOver=t,void e.$broadcast("chart:feed",A.feedOver))},A.outFeed=function(){K=i(function(){A.feedOver=!1,e.$broadcast("chart:feed",!1)},300)},A.toggleFeed(A.feedOpen),e.$on("socketEvent:feedRecentBets",function(t,n){A.feed.length>20&&A.feed.pop();var o=n.history?n.history:n.feed;$.each(o,function(e,t){A.feed.unshift({deposit:c("userMoney")(t.amount,{remZeros:!0,currency:t.currency}),value:t.value,dir:t.direction,user:c("translit")(t.user_firstname+" "+t.user_lastname.substr(0,1)+"."),f:t}),n.history||$(".feed-list").css({right:"-106px"}).animate({right:"-3px"},500)}),e.$apply()}),A.init=function(n,o){A.type=n,F=!0,D(),B=e.$on("socketEvent:initDataChart",A.initDataChart),q=e.$on("socketEvent:listInfoData",A.onListData),N=e.$watch("opt.data.deposit",A.calcalute),H=e.$watch("opt.data.returnPercent",A.calcalute),A.ratesKey=!1,A.rates={},A.ratesOpened=[],A.ratesClosed=[],A.actives=o.result.actives,A.activesEnabled=o.result.defaults.actives_enabled,A.activesSchedule=o.result.defaults.actives_schedule,A.activesMinMax=o.result.defaults.actives_minmax,A.activesLocked={},a.user.profile.demo&&2!=a.user.profile.balance_type&&(A.activesLocked="turbo"==A.type?{1:!1,2:!0,72:!0,4:!0,8:!0,5:!0,9:!0,10:!1,3:!0,73:!1}:{1:!1,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,10:!1,11:!0,12:!1,13:!0,14:!1,15:!0,16:!0,18:!0,19:!0,20:!0,21:!1,22:!0,23:!0,24:!0,25:!0,26:!0,27:!1,28:!0,29:!0,30:!0,31:!0,32:!1,33:!0,34:!0,35:!0,36:!1,37:!0,38:!0,39:!0,40:!0,41:!0,42:!0,43:!0,44:!0,45:!0,46:!0,47:!0,48:!0,49:!0,50:!0,51:!0,52:!0,53:!0,54:!0,55:!0,56:!0,57:!0,58:!0,59:!0,60:!1,65:!0,66:!1,67:!0,68:!0,69:!0,70:!1,71:!1,72:!0,73:!1}),v(),y(),A.timesProfit=o.result.option,A.data.rateInOneClick=0,0==a.user.profile.demo&&(A.data.rateInOneClick=s.get("rateInOneClick"));var i=A.settings(),c=!1;r.active?c=r.active:i&&(c=i.active),c&&A.activesEnabled[c]&&!A.activesLocked[c]?A._selectActive(c,!0):b(),f(),i?(A.data.deposit=i.deposit,A.deposits=i.deposits,A.data.deposit<A.active.min&&(A.data.deposit=A.active.min),A.data.deposit>A.active.max&&(A.data.deposit=A.active.max),g()):A.data.deposit=A.active.min;var u={};$.each(o.result.list,function(e,t){$.each(t,function(e,t){u[e]=t})}),k(u),W=e.$on("socketEvent:timeChange",A.timeChange),t.get("/api/game/getlast?type="+A.type).success(function(e){var t;$.each(e,function(e,n){n.expSite=l.convert(n.expired),t=w(n.expSite,n.active_id),S(t,n,!0),A.rates[t].id=n.id,A.rates[t].list={length:n.id.length},A.rates[t].deposit=n.amount,A.rates[t].profit=n.win_amount,A.rates[t].diff=A.rates[t].profit-A.rates[t].deposit}),x()}),z.resolve()},p(function(){A.achtungTime=A.deadTime-a.currentSiteTime<a.optionAchtungTime,A.ratesKey&&"buyOptionExpire"!=A.currentPanel&&T()},1e3),A.newRate=function(){A._selectRates(!1),A.currentPanel="buyOption"},A.newRateFinish=function(){u.closeAll(),A.newRate()},A.hideFinishPopup=function(){A.rates[A.ratesKey].popup.hideAll(),A.rates[A.ratesKey].showFinishPopup=!1},A.showFinishPopup=function(){A.rates[A.ratesKey].popup.showAll(),A.rates[A.ratesKey].showFinishPopup=!0},A.selectRates=function(e){A.ratesKey!=e&&(!e&&A.ratesKey&&A.clearFeeds(),A._selectRates(e))},A._selectRates=function(e){A.ratesKey=e;var t,n,o=[];e?(n=A.rates[A.ratesKey],t=n.activeId,o=n.list,n.old&&(o=[])):t=A.lastActive.value,A._selectActive(t,!1),a.$broadcast("chart:setRates",o),C(),n&&(n.finish||n.old)&&_(),x()},A.onChangeTime=function(e){if(!A.ratesKey){A.lastActive.expTime=e;var t=A.lastActive.expTime-1e3*A.initData.result.defaults.deadtime;A.lastActive.buyExpire=t}A.selectTime(e,A.ratesKey),A.ratesKey&&A.rates[A.ratesKey].expSite!=e&&A._selectRates(!1)},A.selectTime=function(e,t){A.deadTime=parseInt(e),a.$broadcast("chart:deadTime",parseInt(e),1e3*A.initData.result.defaults.deadtime,t)},A.onLoadChart=function(e){E=e,A.chart=E,U.resolve()},A.initDataChart=function(t,n){var r=n.dataChart.data;if(0==r.length)return void A.simplePopup(c("i18n")("front.error").toString(),c("i18n")("front.no data").toString());for(var i=0;i<r.length;i++)r[i][0]=l.convert(parseInt(r[i][0]));a.$broadcast("chart:data",r,F),F=!1,V&&V(),V=e.$on("socketEvent:newChartData",A.newChartData),o.emit("setActives",{actives:[A.active.value.toString()]}),C()},A.timeChange=function(t,n){try{n.data?(A.timesProfit=n.data[A.type][a.user.profile.group_id],console.log("time change data.data, why?")):A.timesProfit=n[A.type][a.user.profile.group_id]}catch(o){console.log("error",n,A.type,a.user.profile.group_id,o)}C(),e.$apply()},A.settings=function(e){var t=s.get("traderoom")||{};if(!e)return t[A.type];var n={};n[A.type]=e,n=$.extend(t,n),s.set("traderoom",n)},A.newChartData=function(e,t){if(A.active.value!=t.active_id||I==t.time&&L==t.value)return void(t.round&&a.$broadcast("socketEvent:chartTimeSync",1e3*n));A.active.data=t;var n=parseInt(t.time);t.round&&a.$broadcast("socketEvent:chartTimeSync",1e3*n);var o=[l.convert(n),t.value];I=t.time,L=t.value;var r=!0;A.ratesKey&&(r=!A.rates[A.ratesKey].finish),a.$broadcast("chart:data",[o],r)},A.selectActive=function(e,t,n){R&&i.cancel(R),R=i(function(){A._selectActive(e,t,n)},300)},A._selectActive=function(e,t){if(A.active&&A.active.value==e&&A.type==Y)return!1;if(Y=A.type,A.feed=[],A.clearFeeds(),A.activesObj[e].enabled){A.active=A.activesObj[e],a.$broadcast("chart:removeRates"),t&&(A.ratesKey=!1,A.currentPanel="buyOption",A.isBuying=!1,A.hideDir(),A.lastActive=A.activesObj[e],C(),A.calcalute()),a.$broadcast("chart:showLoading"),o.emit("getSchedule",{type:A.type,ids:[e]});{a.$on("socketEvent:schedule",function(t,n){n.activeId&&(n[e].time_to_open?console.log("active not work"):n[e].time_to_close)})}}a.title=c("i18n")(A.activesObj[e].name).toString()+" - "+c("i18n")("front."+A.type+" option").toString()+" - "+c("i18n")("front.title-name").toString(),o.emit("optionsChartData",{id:e,type:A.type,index:0}),o.emit("feedRecentBetsHistory",{id:e,type:A.type})},A.showDir=function(e){a.$broadcast("chart:showDir",e)},A.hideDir=function(){A.isBuying||a.$broadcast("chart:hideDir")},A.simplePopup=function(e,t){u.show({templateUrl:"/views/common/popups/bootstrap.html",backdrop:!0,backdropClass:"backgrop-dark",scopeLocals:{modal:{title:e,body:t}}})},A.buyConfirm=function(e){A.dir=e,A.isBuying=!0,A.data.rateInOneClick?A.buy(e):A.currentPanel="buyOptionConfirm"},A.buyCancel=function(){A.currentPanel="buyOption",A.isBuying=!1,A.hideDir()},A.setDeposit=function(e){A.data.deposit=e},A.buy=function(n){if(u.closeAll(),parseFloat(a.user.profile.balance)<parseFloat(A.data.deposit))return u.show({templateUrl:"/views/traderoom/popups/popup.counting.html",backdrop:!0,backdropClass:"backgrop-dark"}),void A.buyCancel();if(a.user.profile.trial)switch(a.user.profile.trial){case"Trial A":return u.register(),void A.buyCancel();case"Trial B":var r=s.get("trialBuyCount");if(r&&r>=3)return u.register(),void A.buyCancel();r=r||0,r++,s.set("trialBuyCount",r);break;case"Trial C":}A.storageFavActives[A.active.value]?A.storageFavActives[A.active.value]++:A.storageFavActives[A.active.value]=1,s.set(a.optionType+".favActives",A.storageFavActives),A.dir=n;{var i={price:A.data.deposit,refund_value:A.data.returnPercent,act:A.active.value,exp:A.timesValue[A.data.expTime].time,type:A.type,direction:A.dir,value:A.active.data.value,time:A.active.data.time};A.active.data.value}if(A.currentPanel="buyOption",$.cookie("buySocket")){o.emit("buy",i);var c=e.$on("socketEvent:buyComplete",function(e,t){c(),A.onBuy(t)})}else t.post("/api/billing/buy",i).success(function(e){A.onBuy(e)})},A.onBuy=function(e){if(e.isSuccessful){var t=A.settings(),n=[];t&&t.deposits&&(n=t.deposits),-1==n.indexOf(parseFloat(A.data.deposit))&&n.unshift(parseFloat(A.data.deposit)),n.length>5&&n.pop(),A.deposits=n,A.settings({deposit:parseFloat(A.data.deposit),active:A.active.value,"return":A.data.returnPercent,deposits:n});var o=e.result;o.dir=e.result.direction,o.sum=e.result.price,o.createdSite=l.convert(o.created),o.expired=o.exp,o.expSite=l.convert(o.exp),o.active=A.active.name,o.active_id=o.act;var r=w(o.expSite,o.act);S(r,o,!1),A.rates[r].deposit=0,A.rates[r].list.push(o),A.rates[r].list.length>1&&(A.rates[r].flashEffect=!0,i(function(){A.rates[r].flashEffect=!1},1e3)),$.each(A.rates[r].list,function(e,t){A.rates[r].deposit+=t.sum}),A._selectRates(r),A.buyCancel()}else A.isBuying=!1,A.hideDir(),A.simplePopup(c("i18n")("front.error buy option").toString(),e.message[0])},A.applyRateInOneClick=function(){s.set("rateInOneClick",!0),u.closeAll()},A.cancelRateInOneClick=function(){u.closeAll(),A.data.rateInOneClick=!1},A.changeRateInOneClick=function(t){t?u.show({templateUrl:"/views/traderoom/popups/popup.rateInOneClick.html",backdrop:!0,backdropClass:"backgrop-dark",scope:e}):s.set("rateInOneClick",t)},A.onListData=function(t,n){k(n),e.$apply()},A.calcalute=function(){var e=200-(A.data.returnPercent+A.data.commission);A.data.profitMoney=(A.data.deposit||0)*e/100,A.data.profitPercent=100-(A.data.returnPercent+A.data.commission),A.data.returnMoney=(A.data.deposit||0)*(A.data.returnPercent/100)},e.$on("$destroy",function(){D(),P&&P(),M&&M()}),e.$on("$changeLang",function(){a.title=c("i18n")(A.active.name).toString()+" - "+c("i18n")("front."+A.type+" option").toString()+" - "+c("i18n")("front.title-name").toString()})}])}(),function(){app.controller("BuyCtrl",["$scope","$http","$location","$optSocket","$stateParams","$rootScope","$filter","$timeout","$q","$state",function(e,t,n,o,r,a,i){function s(){e.deposit={required:i("i18n")("front.empty deposit").toString(),nmin:i("i18n")("front.min deposit").toString()+" "+e.opt.active.min,nmax:i("i18n")("front.max deposit").toString()+" "+e.opt.active.max,pattern:i("i18n")("front.enter number").toString()}}var c=this;c.isSubmitted=!1,e.opt.initPromise.then(function(){s()}),e.$on("$changeLang",function(){s()}),c.buyConfirm=function(t){return e.frm.$invalid?void(c.isSubmitted=!0):void e.opt.buyConfirm(t)}}])}(),function(){app.userRouting=function(e){e.state("user",{url:"/{lang:.{2}}",views:{"@":{templateUrl:getTemplate("/views/user/layout.html")},"header@user":{templateUrl:getTemplate("/views/user/header.html")},"menu@user":{templateUrl:getTemplate("/views/user/menu.html")}},onEnter:["$http","$rootScope",function(e,t){t.user.isAuth&&e.get("/api/game/getoptiontypes").success(function(e){t.options={},t.options.types=e})}],"abstract":!0}).state("user.main",{url:"",views:{"content@user":{templateUrl:getTemplate("/views/site/pages/main.html")}}}).state("user.cabinet",{"abstract":!0,title:"front.personal cabinet",onEnter:["$rootScope","$state","$http",function(e,t,n){if(1!=e.user.profile.balance_type){var o=null;if($.each(e.user.profile.balances||[],function(e,t){1==t.type&&(o=t.id)}),o){var r={method:"post",url:"api/profile/changeaccount",data:{balance_id:o}};n(r).success(function(e){e.isSuccessful||t.go("user.tournament")}).error(function(){t.go("user.tournament")})}}e.user.profile.confirm&&t.go("user.cabinet.profile.confirm")}]}).state("user.cabinet.stats",{"abstract":!0}).state("user.cabinet.stats.trade",{url:"/stats/trade",views:{"content@user":{templateUrl:getTemplate("/views/user/cabinet/stats/stats.trade.html"),controller:"TradeStatsCtrl"}},title:"front.trade stats"}).state("user.cabinet.stats.money",{url:"/stats/money",views:{"content@user":{templateUrl:getTemplate("/views/user/cabinet/stats/stats.money.html"),controller:"MoneyStatsCtrl"}},title:"front.money in out stats"}).state("user.cabinet.profile",{url:"/profile",views:{"content@user":{templateUrl:getTemplate("/views/user/cabinet/profile/profile.html")},"contact@user.cabinet.profile":{templateUrl:getTemplate("/views/user/cabinet/profile/profile.contact.html")},"password@user.cabinet.profile":{templateUrl:getTemplate("/views/user/cabinet/profile/profile.password.html")},"settings@user.cabinet.profile":{templateUrl:getTemplate("/views/user/cabinet/profile/profile.settings.html")}}}).state("user.cabinet.profile.password",{url:"/password"}).state("user.cabinet.profile.settings",{url:"/settings"}).state("user.cabinet.profile.confirm",{url:"/confirm",views:{"content@user":{templateUrl:getTemplate("/views/user/cabinet/profile/profile.confirm.html")}}}).state("user.cabinet.counting",{url:"/cabinet/counting?bonuscode",views:{"content@user":{templateUrl:getTemplate("/views/user/cabinet/counting/counting.html")}},title:"front.refresh counting"}).state("user.cabinet.counting.features",{url:"/features",views:{"content@user":{templateUrl:getTemplate("/views/user/features.html")}},title:"front.opening account"}).state("user.emailconfirm",{url:"/emailconfirm/{code}",views:{"content@user":{templateUrl:getTemplate("/views/site/pages/email-confirm.html"),controller:["$scope","$stateParams",function(e,t){e.code=t.code}]}},title:"front.email change confirmation"}).state("user.cabinet.counting.success",{url:"/success",views:{"content@user":{templateUrl:getTemplate("/views/user/cabinet/counting/counting.success.html")}},onEnter:["$storage","$external","$rootScope",function(e,t,n){var o=e.get("countingAmount");4==n.user.profile.currency_id&&(o/=36),ga("send","event","pageview","deposit",document.referrer,o),o&&(e.rem("countingAmount"),t.facebookDeposit(o,n.user.profile.currency_id))}]}).state("user.cabinet.counting.failed",{url:"/failed",views:{"content@user":{templateUrl:getTemplate("/views/user/cabinet/counting/counting.failed.html")}}}).state("user.cabinet.tickets",{url:"/cabinet/messages",views:{"content@user":{templateUrl:getTemplate("/views/user/tickets/tickets.html")}},title:"front.messages"}).state("user.cabinet.tickets.new",{url:"/new",views:{"content@user":{templateUrl:getTemplate("/views/user/tickets/tickets.new.html")}}}).state("user.cabinet.tickets.subject",{url:"/subject/:subjectId",views:{"content@user":{templateUrl:getTemplate("/views/user/tickets/tickets.subject.html")}}}).state("user.cabinet.withdrawal",{url:"/withdrawal",views:{"content@user":{templateUrl:getTemplate("/views/user/cabinet/withdrawal.html")}},title:"front.output cash assets",onEnter:["$rootScope","$state","$http",function(e,t,n){if(1!=e.user.profile.balance_type){var o=null;if($.each(e.user.profile.balances||[],function(e,t){1==t.type&&(o=t.id)}),o){var r={method:"post",url:"api/profile/changeaccount",data:{balance_id:o}};n(r).success(function(e){e.isSuccessful||t.go("user.tournament")}).error(function(){t.go("user.tournament")})}}e.user.profile.confirm&&t.go("user.cabinet.profile.confirm")}]}).state("user.logout",{url:"/logout",onEnter:["$http","$rootScope","$optSocket","$state",function(e,t,n){e.get("/api/logout").success(function(){n.disconnect(),n.reconnect()})}]}).state("user.faq",{resolve:{loadArticle:function(){return{d:$.Deferred()}}},url:"/faq",views:{"content@user":{templateUrl:getTemplate("/views/site/pages/faq.html"),controller:"FaqCtrl"}},title:"front.faq"}).state("user.faq.question",{resolve:{loadArticle:function(){return{d:$.Deferred()}}},url:"/{q}"}).state("user.assets",{resolve:{loadArticle:function(){return{d:$.Deferred()}}},url:"/assets",views:{"content@user":{templateUrl:getTemplate("/views/site/pages/assets.html"),controller:"AssetsCtrl"}},title:"front.assets"}).state("user.about",{url:"/about",views:{"content@user":{templateUrl:getTemplate("/views/site/pages/about.html")}},title:"front.about"}).state("user.partners",{url:"/partners",views:{"content@user":{templateUrl:getTemplate("/views/site/pages/partners.html")}},title:"front.be partner"}).state("user.education",{url:"/education",views:{"content@user":{templateUrl:getTemplate("/views/site/pages/education.html")}},title:"front.education"}).state("user.about.contacts",{url:"/contacts",views:{"content@user":{template:'<div ng-include="getTemplateUrl()"></div>',controller:["$rootScope","$scope",function(e,t){t.getTemplateUrl=function(){return getTemplate(e.user.profile.trial?"/views/site/pages/contacts.html":"/views/user/contacts.html")}}]}},title:"front.contact"}).state("user.about.awards",{url:"/awards",views:{"content@user":{templateUrl:getTemplate("/views/site/pages/awards.html")}},title:"front.awards"}).state("user.news",{url:"/news",views:{"content@user":{templateUrl:getTemplate("/views/site/pages/news-all.html")}},title:"front.news"}).state("user.tournament",{url:"/tournament",views:{"content@user":{templateUrl:getTemplate("/views/site/tournament.html"),controller:"TournamentCtrl"}},title:"front.tournament",onEnter:["$rootScope","$http","$state",function(e,t,n){if(2!=e.user.profile.balance_type){var o=null;if($.each(e.user.profile.balances||[],function(e,t){2==t.type&&(o=t.id)}),o){var r={method:"post",url:"api/profile/changeaccount",data:{balance_id:o}};t(r).success(function(e){e.isSuccessful||n.go("user.tournament")}).error(function(){n.go("user.tournament")})}}}]}).state("user.page",{url:"/page/{page}",views:{"content@user":{templateUrl:getTemplate("/views/site/page.html"),controller:"PageCtrl"}}}).state("user.crofr",{url:"/crofr",views:{"content@user":{templateUrl:getTemplate("/views/site/pages/crofr.html")}}}).state("user.trial",{url:"/register/trial",onEnter:["$state",function(e){e.transitionTo("user.traderoom.turbo")}]}).state("user.activate",{url:"/account/activate/{code}",views:{"content@user":{templateUrl:getTemplate("/views/site/pages/activate.html")}},title:"front.account activation"}).state("user.not-activate",{url:"/account/not-activated?email&id",views:{"content@user":{templateUrl:getTemplate("/views/site/pages/reactivate.html")}},title:"front.account activation"}).state("user.qiwi",{url:"/qiwi?op_id&fields&pay_url&payment_method_id",views:{"@":{templateUrl:getTemplate("/views/user/cabinet/counting/qiwi.html")}}}).state("user.404",{url:"/404",views:{"@":{templateUrl:getTemplate("/views/404.html")}}})}}(),function(){app.filter("dateFormat",["$rootScope",function(e){return function(t){moment.lang("en",{calendar:{lastDay:"[Yesterday at] LT",sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",lastWeek:"LLL",nextWeek:"LLL",sameElse:"LLL"}}),moment.lang("ru",{calendar:{lastDay:"[Вчера в] LT",sameDay:"[Сегодня в] LT",nextDay:"[Завтра в] LT",lastWeek:"D MMMM YYYY [в] LT",nextWeek:"D MMMM YYYY [в] LT",sameElse:"D MMMM YYYY [в] LT"}}),moment.lang(e.lang.current.key),t=moment(t);var n=moment().diff(t,"hours");return 5>n?t.fromNow():t.calendar()}}])}(),function(){app.controller("UserEmailConfirmCtrl",["$scope","$http","$rootScope","$element","$location","$filter","$sce",function(e,t,n,o,r,a,i){e.code?t({method:"get",url:"/api/emailconfirm/"+e.code}).success(function(t){e.alert=t.isSuccessful?{className:"call-color",message:i.trustAsHtml(t.message[0])}:{className:"put-color",message:a("i18n")("front.bad code email confirm")}}):e.alert={className:"put-color",message:a("i18n")("front.bad code email confirm")}}])}(),function(){app.controller("ProfileCtrl",["$scope","$http","$element","$timeout","$popup","$state",function(e,t,n,o,r,a){var i=this;i.currentTab=a.current.name,i.regData={},i.regDataDefer=$.Deferred(),t({method:"get",url:"/api/register/getregdata"}).success(function(e){i.regData=e.result,i.regData.profile.phone_code=e.result.profile.phone.split(" ")[0],i.regData.profile.phone=e.result.profile.phone.split(" ")[1],i.regDataDefer.resolve(e.result)})}]),app.controller("ProfileContactCtrl",["$scope","$http","$rootScope","$element","$timeout","$filter",function(e,t,n,o,r,a){function i(){e.postal_index={pattern:a("i18n")("front.error index").toString(),minlength:a("i18n")("front.shortly index").toString()}}var s=this;s.data={},s.configDatePicker={singleDatePicker:!0,showDropdowns:!0,minDate:moment().add("years",-100).startOf("year").format("DD.MM.YYYY"),maxDate:moment().add("years",-18).startOf("year").format("DD.MM.YYYY"),startDate:moment().add("years",-30).startOf("year").format("DD.MM.YYYY")},i(),e.$on("$changeLang",function(){i()}),s.setFormDirty=function(){e.frm.$setDirty()},e.profile.regDataDefer.done(function(t){var n=t.profile;s.data.first_name=n.first_name,s.data.last_name=n.last_name,s.data.phone=n.phone,s.data.address=n.address,s.data.gender=n.gender,s.data.country_id=n.country_id,s.data.city=n.city,s.data.postal_index=n.postal_index,s.data.phone_code=n.phone_code,s.data.email=n.email,s.data.birthday=moment(1e3*n.birthdate).format("DD.MM.YYYY"),e.$watch("contact.data.country_id",function(e,n){e!=n&&(s.data.phone_code=t.phone_codes[s.data.country_id])})});var c=!1;e.$watch("contact.data.email",function(e){e!=n.user.profile.email?!c&&e&&(c=!0):c=!1}),s.save=function(){var n={method:"post",data:s.data,url:"/api/profile/general"};t(n).success(function(t){t.isSuccessful?(e.form.showInfo(e,t,2e3),e.form.buttonEnable()):e.form.showErrors(e,t)}),c&&(n={method:"post",data:{email:s.data.email},url:"/api/profile/password"},t(n).success(function(t){t.isSuccessful?(e.form.showInfo(e,t,2e3),e.form.buttonEnable()):e.form.showErrors(e,t)}))}}]),app.controller("ProfilePasswordCtrl",["$scope","$http","$rootScope","$element","$timeout",function(e,t){var n=this;n.data={},e.profile.regDataDefer.done(function(e){n.data.email=e.profile.email}),n.setFormDirty=function(){e.frm.$setDirty()},n.save=function(){var o={method:"post",data:n.data,url:"/api/profile/password"};t(o).success(function(t){t.isSuccessful?(n.data.current_password="",n.data.password="",n.data.password2="",e.form.showInfo(e,t,2e3),e.form.buttonEnable()):e.form.showErrors(e,t)})}}]),app.controller("ProfileSettingsCtrl",["$scope","$http","$rootScope","$element","$timeout","$lang",function(e,t,n,o,r,a){var i=this;i.data={},e.profile.regDataDefer.done(function(e){var t=e.profile;i.data.currency_id=t.currency_id.toString()+"",i.data.tz=t.tz,i.data.lang=t.locale}),i.setFormDirty=function(){e.frm.$setDirty()},i.save=function(){var n={method:"post",data:i.data,url:"/api/profile/settings"};t(n).success(function(t){t.isSuccessful?(e.form.showInfo(e,t,2e3),e.form.buttonEnable(),a.change(i.data.lang)):e.form.showErrors(e,t)})}}])}(),function(){app.controller("UserAccountActivateCtrl",["$scope","$http","$rootScope","$element","$location","$filter","$timeout","$external","$state","$optSocket","$sce",function(e,t,n,o,r,a,i,s,c,l){e.account="",c.params.code?t({method:"get",url:"/api/activate/"+c.params.code}).success(function(t){if(t.isSuccessful){e.account="wait",e.info=a("i18n")("front.account activation wait"),ga("send","event","pageview","activate"),s.am(),s.pixel(),s.fbPixel(),s.actionads(),s.media(),l.disconnect(),l.reconnect();var o=n.$on("socketEvent:profile",function(t,n){n&&(e.info=a("i18n")("front.account_activated"),e.account="success",i(function(){c.go("user.traderoom.turbo")},5e3)),o()})}else e.account="failed"}):(e.alert={show:!0,className:"alert-error",message:a("i18n")("front.bad code").toString()},e.account="failed")}])}(),function(){app.controller("UserAccountNotActivatedCtrl",["$scope","$http","$rootScope","$location","$sce","$filter",function(e,t,n,o,r,a){var i;n.buffer&&n.buffer.accountActivate&&(i=n.buffer.accountActivate),e.sended=!1,e.error=!1;var s=o.$$search;!i&&s.email&&s.email.match(/^\w+[\w\-]*\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/)&&s.id&&s.id.match(/^\d+$/)&&(i={email:o.$$search.email,id:o.$$search.id}),i?(e.email=i.email,e.reactivate=function(){e.preloader=!0,t({method:"post",url:"/api/register/reactivate",data:{email:i.email,id:i.id}}).success(function(t){t.isSuccessful?(e.preloader=!1,e.sended=!0):e.sendedErr=t.message[0]?r.trustAsHtml(t.message[0]):a("i18n")("front.send error").toString()})}):e.error=!0}])}(),function(){app.controller("UserAccountRetrieveCtrl",["$scope","$http","$rootScope","$element","$location","$filter",function(e,t,n,o,r,a){function i(){e.password2={required:a("i18n")("front.empty password2").toString()}}e.alert={show:!1,className:"",message:""},e.status="";var s=this;s.data={code:e.code},i(),e.$on("$changeLang",function(){i()}),s.save=function(){var n={method:"post",data:s.data,url:"/api/retrieve"};t(n).success(function(t){t.isSuccessful?(e.alert={className:"call-color",message:a("i18n")("front.password change success").toString()},e.status="message"):e.form.showErrors(e,t)})},e.code?t({method:"post",data:{code:e.code},url:"/api/checkretrieve/"}).success(function(t){t.isSuccessful?e.status="form":(e.alert={className:"put-color",message:a("i18n")("front.bad code").toString()},e.status="message")}):(e.alert={className:"put-color",message:a("i18n")("front.bad code").toString()},e.status="message")}])}(),function(){app.controller("MoneyStatsCtrl",["$scope","$http","$rootScope","$timeout","$time","$location","$filter",function(e,t,n,o,r,a,i){function s(){t({method:"get",url:"/api/iostat/getfilters"}).success(function(t){t.isSuccessful&&(t.result.type.splice(0,1),t.result.status_type.splice(0,1),e.operationType=t.result.type,e.operationType.unshift({name:i("i18n")("front.all operation types").toString(),value:-1}),e.statusType=t.result.status_type,e.statusType.unshift({name:i("i18n")("front.all statuses").toString(),value:-1}))
})}e.itemsPerPage=10,e.config={},e.data=[],e.sortField="created",e.sortReverse=!1,e.currentActive=-1,e.optionStatus=-1,e.isInit=!1,e.currentOperationType=-1,e.currentStatusType=-1,e.dateRange=moment().subtract("days",29).format("DD.MM.YYYY")+" - "+moment().format("DD.MM.YYYY"),e.config.period_from=moment().subtract("days",29).format("DD.MM.YYYY"),e.config.period_to=moment().format("DD.MM.YYYY"),e.onSelect=function(t,n){e.config.period_from=t.format("DD.MM.YYYY"),e.config.period_to=n.format("DD.MM.YYYY")},e.changeFilter=function(){e.config.type=e.currentOperationType,e.config.status_type=e.currentStatusType,e.getPage(1)},e.getPage=function(n){e.currentPage=n.toString(),t({method:"post",url:"/api/iostat/filter",data:$.extend(e.config,{p:(n-1)*e.itemsPerPage,l:e.itemsPerPage})}).success(function(t){t.isSuccessful&&(e.data=t.result.data,$.each(e.data,function(e,t){t.createdSite=moment(r.convert(t.created)).format("DD.MM.YYYY, HH:mm")}),e.totalItems=t.result.total,e.isInit=!0)})},e.$on("$changeLang",function(){s(),e.changeFilter()}),s(),e.getPage(1)}])}(),function(){app.controller("TradeStatsCtrl",["$scope","$http","$rootScope","$timeout","$time","$location","$filter",function(e,t,n,o,r,a,i){function s(){t({method:"get",url:"/api/tradestat/getfilters"}).success(function(t){t.isSuccessful&&(e.option_types=t.result.option_types,delete t.result.actives[0],e.actives=t.result.actives,e.config.option_status=e.optionStatus)}),e.options_statuses=[{value:-1,name:i("i18n")("front.all").toString()},{value:1,name:i("i18n")("front.closed2").toString()},{value:2,name:i("i18n")("front.opened2").toString()}]}e.itemsPerPage=10,e.config={},e.data=[],e.sortField="created",e.sortReverse=!1,e.currentActive=-1,e.currentOptionType=-1,e.optionStatus=-1,e.isInit=!1,e.dateRange=moment().subtract("days",29).format("DD.MM.YYYY")+" - "+moment().format("DD.MM.YYYY"),e.config.period_from=moment().subtract("days",29).format("DD.MM.YYYY"),e.config.period_to=moment().format("DD.MM.YYYY"),e.onSelect=function(t,n){e.config.period_from=t.format("DD.MM.YYYY"),e.config.period_to=n.format("DD.MM.YYYY")},e.changeFilter=function(){e.config.option_type_id=e.currentOptionType,e.config.active_id=e.currentActive,e.config.option_status=e.optionStatus,e.getPage(1)},e.$on("$changeLang",function(){moment.lang(n.lang.current.key),s(),e.changeFilter()}),e.getPage=function(n){e.currentPage=n.toString(),t({method:"post",url:"/api/tradestat/filter",data:$.extend(e.config,{p:(n-1)*e.itemsPerPage,l:e.itemsPerPage})}).success(function(t){t.isSuccessful&&(e.data=t.result.data,$.each(e.data,function(e,t){t.dir=t.value.match(/class="(.+?)"/)[1],t.value=t.value.replace(/<span.+<\/span>/,""),t.createdSite=moment(r.convert(t.created)).format("DD.MM.YYYY, HH:mm:ss")}),e.totalItems=t.result.total,e.isInit=!0)})},s(),e.getPage(1)}])}(),function(){app.controller("WithdrawalCtrl",["$scope","$http","$rootScope","$timeout","$filter","$sce",function(e,t,n,o,r,a){function i(){e.amount={required:r("i18n")("front.you didnt specified the amount").toString(),pattern:r("i18n")("front.incorrect amount").toString(),nmin:r("i18n")("front.amount smaller than").toString()+" "+r("userMoney")(n.user.profile.money.withdraw.min).toString(),nmax:r("i18n")("front.amount greater than").toString()+" "+r("userMoney")(n.user.profile.money.withdraw.max).toString()},e.details={required:r("i18n")("front.you didnt specified the payment details").toString()},e.accountOwner={required:r("i18n")("front.you didnt specified the account owner").toString()},e.accountNumber={required:r("i18n")("front.you didnt specified the account number").toString()},e.swiftCode={required:r("i18n")("front.you didnt specified the swift code").toString()},e.cardNumber={required:r("i18n")("front.you didnt specified the card number").toString()},e.cardOwner={required:r("i18n")("front.you didnt specified the card owner").toString()}}function s(){t.get("/api/getwithdrawalmethods").success(function(e){e.isSuccessful&&(c.methods=e.result,c.data.payment_method_id=e.result[0].value.toString())})}var c=this;c.data={},c.status="form","1"==n.user.profile.demo&&(c.status="demo"),e.$on("$changeLang",function(){i(),s()}),i(),s(),c.changeMethod=function(t){e.form.isSubmitted=!1,$.each(c.methods,function(e,n){return n.value==t?(c.current=c.methods[e],c.current.commentHtml=a.trustAsHtml(c.current.comment),console.log(c.current),!1):void 0})},c.send=function(){var n={method:"post",data:c.data,url:"/api/billing/withdraw"};t(n).success(function(t){t.isSuccessful?c.status="complete":e.form.showErrors(e,t)})}}])}(),function(){app.controller("TicketCtrl",["$scope","$http","$rootScope","$timeout","$location","$state",function(e,t,n,o,r){e.$on("$changeLang",function(){moment.lang(n.lang.current.key)}),e.ticketCreated=!1,e.itemsPerPage=7,e.isInit=!1,e.newSubject=function(){e.ticketCreated=!1},e.getPage=function(n){e.currentPage=n.toString();var o={method:"post",url:"/api/ticket/list",data:{p:(n-1)*e.itemsPerPage,l:e.itemsPerPage}};t(o).success(function(t){t.isSuccessful&&(e.subjects=t.result.subjects,e.subjectsObj={},_.each(e.subjects,function(t){e.subjectsObj[t.id]=t.name}),e.totalItems=t.result.total,e.tickets=t.result.tickets,e.isInit=!0)})},e.openSubject=function(e){r.url("/cabinet/messages/subject/"+e)},e.$on("socketEvent:profile",function(t,n){n.messages>0&&o(function(){e.getPage(1)},200)}),e.getPage(1)}]),app.controller("TicketBranchCtrl",["$scope","$http","$rootScope","$timeout","$stateParams",function(e,t,n,o,r){e.data={},e.pid=r.subjectId,e.itemsPerPage=10,e.$on("ticket:success",function(){e.getPage(1),e.data={},e.data.pid=r.subjectId}),e.getPage=function(n){e.currentPage=n.toString();var o={method:"post",url:"/api/ticket/list",data:{pid:r.subjectId,p:(n-1)*e.itemsPerPage,l:e.itemsPerPage}};t(o).success(function(t){if(t.isSuccessful){e.subjects=t.result.subjects,e.subjectsObj={},e.tickets=t.result.tickets,e.totalItems=t.result.total;for(var n in t.result.tickets){var o=t.result.tickets[n].subject;_.each(t.result.subjects,function(t){t.id==o&&(e.subject=t.name)});break}}})},e.$on("socketEvent:profile",function(t,n){n.messages>0&&o(function(){e.getPage(1)},200)}),e.getPage(1)}]),app.controller("TicketNewCtrl",["$scope","$rootScope","$state",function(e,t,n){e.$on("$changeLang",function(){moment.lang(t.lang.current.key)}),e.$on("ticket:success",function(e,t){n.go("user.cabinet.tickets.subject",{subjectId:t})})}]),app.controller("TicketFormCtrl",["$scope","$http","$rootScope","$timeout","$q","$filter",function(e,t,n,o,r,a){function i(){e.question={required:a("i18n")("front.empty text").toString(),minlength:a("i18n")("front.shortly text").toString()}}function s(){t(l).success(function(e){e.isSuccessful&&(c.subjects=e.result.subjects)})}var c=this;c.data={subject:1},e.pid&&(c.data.pid=e.pid),i();var l={method:n.user.isAuth?"post":"get",url:n.user.isAuth?"/api/ticket/list":"/api/ticket/getsubjects"};s(),e.$on("$changeLang",function(){s(),i()}),c.send=function(){var n=r.defer(),o=n.promise,a={method:"post",data:c.data,url:"/api/ticket/send"};return t(a).success(function(t){if(t.isSuccessful){var o=t.result;e.$emit("ticket:success",o),c.data.question="",n.resolve()}else e.form.showErrors(e,t),n.resolve()}).error(function(){}),o}}])}(),function(){app.controller("CountingCtrl",["$scope","$http","$rootScope","$timeout","$location","$modal","$sce","$state","$storage","$filter","$stateParams","$popup",function(e,t,n,o,r,a,i,s,c,l,u,p){function d(){v.deposits=4==n.user.profile.currency_id?v.depositsRubbles:v.depositsDollars,v.data.amount||(v.current&&(v.data.amount=v.current.deposit),$.each(v.deposits,function(e,t){!v.current&&t.selected&&v.select(t),t.bonus?(t.total=t.deposit+t.deposit/100*t.bonus,v.data["bonus"+t.bonus]=!0):t.total=t.deposit}))}function f(){var t=0,o=0;n.user.isAuth&&(t=n.user.profile.money.deposit.min,o=n.user.profile.money.deposit.max),e.amount={nmin:l("i18n")("front.amount is less than min",{min:t}).toString(),nmax:l("i18n")("front.amount is more than max",{max:o}).toString(),pattern:l("i18n")("front.incorrect amount").toString(),required:l("i18n")("front.you didnt specified the amount").toString()}}function m(e,t,n){$("<input>").attr({type:"hidden",name:e,value:t}).appendTo(n)}function h(){t({method:"get",url:"/api/game/getpaysystems"}).success(function(e){e.isSuccessful?v.paysystems=e.result:console.log("error",e.message)})}function g(){t({method:"get",url:"/api/register/getregdata"}).success(function(e){e.isSuccessful&&(v.profile=e.result.profile,v.currency_id=e.result.profile.currency_id.toString(),v.data.currency_id=v.currency_id,v.currency_enabled=1==parseInt(e.result.currency_enabled,10),v.currency=e.result.currency)})}var v=this;v.data={},v.state="deposit",v.showBonus=!1,v.bonusCtrl=null,v.loading=!1,v.bonuscode="",v.deposits=[],v.depositsRubbles=[{deposit:3e4,bonus:80,bonuscode:"bonus80_z8akmH19xI91",vip:!0},{deposit:15e3,bonus:60,bonuscode:"bonus60_nz81Idnz91mB",vip:!0},{deposit:7500,bonus:40,bonuscode:"bonus40_pp12Un198Lam"},{deposit:3e3,bonus:20,bonuscode:"bonus20_mv81Niia91Pn",popular:!0,selected:!0},{deposit:2e3},{deposit:1e3},{deposit:500}],v.depositsDollars=[{deposit:1e3,bonus:80,bonuscode:"bonus80_z8akmH19xI91",vip:!0},{deposit:500,bonus:60,bonuscode:"bonus60_nz81Idnz91mB",vip:!0},{deposit:250,bonus:40,bonuscode:"bonus40_pp12Un198Lam"},{deposit:100,bonus:20,bonuscode:"bonus20_mv81Niia91Pn",popular:!0,selected:!0},{deposit:50},{deposit:30},{deposit:20}],"BP C"==n.user.profile.user_circle&&(v.depositsRubbles.push({deposit:300}),v.depositsDollars.push({deposit:10})),e.$on("counting:bonusClear",function(){v.current&&v.current.bonus&&(v.data["bonus"+v.current.bonus]=!1)}),v.chooseDepositByName=function(e){$.each(v.deposits,function(t,n){return n[e]?(v.select(n),v.showDescr=!1,$("html, body").animate({scrollTop:"0px"}),!1):void 0})},v.toggleBonus=function(e,t){e.stopPropagation(),o(function(){if(v.current==t){var e=v.data["bonus"+t.bonus];e?(v.showBonus=!0,v.bonuscode=t.bonuscode,v.bonusCtrl.data.bonusCode=t.bonuscode):v.bonusCtrl&&v.bonusCtrl.clear()}})},v.toCounting=function(){p.closeAll(),console.log(v.data["bonus"+v.current.bonus]);var e=v.data["bonus"+v.current.bonus];v.current.checked=e,console.log(v.current.checked,e),n.popupCounting=v.current,s.go("user.cabinet.counting")},v.select=function(e){v.data["radio"+e.deposit]=!0,v.current=e,v.data.amount=e.deposit,v.showBonus=e.bonus?!0:!1,v.data["bonus"+v.current.bonus]?(v.bonuscode=e.bonuscode||"",v.bonusCtrl&&(v.bonusCtrl.data.bonusCode=e.bonuscode||"")):(v.bonuscode="",v.showBonus=!1,v.bonusCtrl&&v.bonusCtrl.clear())},e.$watch("counting.data.amount",function(e){if(e){var t=v.current?!0:!1;v.current=!1,$.each(v.deposits,function(t,n){return e==n.deposit?(v.select(n),!1):void 0}),t&&!v.current&&v.bonusCtrl&&v.bonusCtrl.clear()}}),("BP B"==n.user.profile.user_circle||"BP C"==n.user.profile.user_circle)&&d(),v.popupCounting=function(){d()},v.form=function(e){o(function(){v.frm=e.frm,n.countingAmount&&(v.data.amount=n.countingAmount,v.frm.$setDirty(),delete n.countingAmount)})},v.prevent=function(e,t){t||e.stopImmediatePropagation()},f(),n.$on("socketEvent:profile",function(){d(),f(),v.loading=!1,v.data.amount&&(v.isSubmitted=!0)}),e.$on("$changeLang",function(){f()}),e.$on("counting:bonusCtrl",function(t,o){if(v.bonusCtrl=o,v.bonuscode&&(v.bonusCtrl.data.bonusCode=v.bonuscode),e.$broadcast("counting:countingCtrl",v),n.popupCounting){console.log(n.popupCounting);var r=n.popupCounting;delete n.popupCounting,v.amountError=!1,v.state="paysystems",v.data.amount=r.deposit,v.data["bonus"+r.bonus]=r.checked,r.bonus&&r.checked&&(v.showBonus=!0,v.bonusCtrl.data.bonusCode=r.bonuscode,v.bonusCtrl.applyBonus())}}),h(),g(),v.changeCurrency=function(){if(parseInt(n.user.profile.currency_id)!=parseInt(v.data.currency_id)){v.isSubmitted=!1,v.loading=!0,v.data.amount="",v.current=!1;var e={method:"post",url:"/api/profile/settings",data:{lang:n.lang.current.key,currency_id:v.data.currency_id,tz:n.user.profile.tz}};t(e).success(function(e){e.isSuccessful})}},v.statePaysystems=function(e){return e.$invalid?(v.isSubmitted=!0,!1):(v.data.amount&&v.frm.$setDirty(),e.$pristine?!1:(v.amountError=!1,v.state="paysystems",void v.bonusCtrl.applyBonus()))},v.backToPaysystems=function(){v.state="paysystems"},v.stateDeposit=function(){v.state="deposit"},v.applyBonus=function(){v.bonusCtrl.applyBonus()},v.saveSettings=function(){var e=$.Deferred();return t({method:"post",url:"/api/profile/settings",data:{lang:n.lang.current.key,currency_id:v.data.currency_id,tz:v.profile.tz}}).success(function(){e.resolve()}),e},v.selectPaymethod=function(e){v.saveSettings().done(function(){$.cookie("bonuscode",null,{path:"/"}),c.set("countingAmount",v.data.amount);var n={amount:v.data.amount,payment_method_id:e.fields.payment_method_id,bonuscode:v.bonusCtrl.data.bonusCode},o={method:"post",url:e.action,data:n};t(o).success(function(t){if(t.isSuccessful){var n=$("<form></form>").attr({action:t.result.url});$("body").append(n),1==e.iframe?(v.state="iframe",n.attr({target:"counting-iframe",method:"get"}),0==t.result.url.indexOf("/")&&(m("payment_method_id",e.fields.payment_method_id,n),m("op_id",t.result.op_id,n),m("pay_url",t.result.pay_url,n),m("fields",JSON.stringify(t.result.fields),n))):n.attr({method:"post"}),$.each(t.result.fields,function(e,t){m(t.name,t.value,n)}),n.submit()}else console.log("error",t.message)})})}}])}(),function(){app.controller("FeaturesCtrl",["$scope","$storage","$rootScope","$state","$stateParams",function(e,t,n,o){var r=this;r.counting=function(e,t){var r=4==n.user.profile.currency_id?t:e;n.countingAmount=r,o.go("user.cabinet.counting")}}])}(),function(){app.controller("BonusCodeCtrl",["$scope","$http","$rootScope","$element","$timeout","$location","$stateParams","$filter",function(e,t,n,o,r,a,i,s){var c=this;c.bonusMessage="",c.alert={show:!0,className:"alert-success",message:"dassda"},c.bonusApply=!1,c.bonusAlert=!1,c.bonusApplied=!1,c.data={},c.countingCtrl=null,e.$on("counting:countingCtrl",function(e,t){c.countingCtrl=t,i.bonuscode?(c.countingCtrl.showBonus=!0,c.data.bonusCode=i.bonuscode):$.cookie("bonuscode")&&(c.countingCtrl.showBonus=!0,c.data.bonusCode=$.cookie("bonuscode"))}),e.$watch("bonus.data.bonusCode",function(e){c.bonusApply=!1,c.bonusApplied=!1,c.bonusAlert=!1,t({method:"post",url:"/api/getbonusinfo",data:{bonuscode:e}}).success(function(e){e.isSuccessful?(c.alert={show:!0,className:"alert-success",message:e.result.text},c.bonusMessage=e.result.text,c.bonusApply=e.result.apply):(c.bonusApply=!1,c.bonusMessage="",c.alert.show=!1,c.bonusError=e.message[0]?e.message[0]:s("i18n")("front.fail code"),$.cookie("bonuscode",null,{path:"/"}))})}),c.applyBonus=function(){return c.bonusApply&&!c.bonusApplied?t({method:"post",url:"/api/applybonus",data:{bonuscode:c.data.bonusCode}}).success(function(e){c.bonusApply=!1,$.cookie("bonuscode",null,{path:"/"}),c.bonusAlert=e.isSuccessful?{"class":"alert-success",message:e.message[0]}:{"class":"alert-danger",message:e.message[0]},c.bonusApplied=!0}):!1},c.clear=function(){c.countingCtrl.showBonus=!1,c.data.bonusCode="",$.cookie("bonuscode",null,{path:"/"}),e.$emit("counting:bonusClear",c)},e.$emit("counting:bonusCtrl",c)}])}(),function(){app.controller("SoundCtrl",["$scope","$rootScope","$timeout","$storage",function(e,t,n,o){var r=o.get("sound")||void 0==o.get("sound");t.sound=r?!0:!1,e.toggle=function(){t.sound=!t.sound,o.set("sound",t.sound?1:0)}}])}(),function(){app.controller("MenuCtrl",["$scope","$rootScope","$state","$storage","$timeout","$location",function(e,t,n,o,r){function a(){switch(t.lang.current.shortKey){case"us":return"gb";case"es":return"es";case"pt":return"br";case"us":return"gb";default:return"ru"}}t.menuCollapsed=!1,e.traderoom=!1,e.profileMenu=!1,e.aboutMenu=!1,o.get("menu")&&(t.menuCollapsed=!0),e.toggle=function(){t.menuCollapsed=!t.menuCollapsed,$(".popover").remove(),o.set("menu",t.menuCollapsed?1:0),r(function(){t.$broadcast("chart:redraw")},100)},e.profile=function(){e.traderoom?n.go("user.cabinet.profile"):n.includes("user.cabinet")||(e.profileMenu=!e.profileMenu)},e.about=function(){e.traderoom?n.go("user.about"):n.includes("user.about")||(e.aboutMenu=!e.aboutMenu)},e.$on("$stateChangeSuccess",function(){n.includes("user.cabinet")&&(e.profileMenu=!0),n.includes("user.about")&&(e.aboutMenu=!0),e.traderoom=n.includes("user.traderoom"),e.traderoom&&(e.profileMenu=!1,e.aboutMenu=!1)}),e.iosApp="https://itunes.apple.com/"+a()+"/app/iq-option-binarnye-opciony/id871125783?ls=1&mt=8",e.$on("$changeLang",function(){e.iosApp="https://itunes.apple.com/"+a()+"/app/iq-option-binarnye-opciony/id871125783?ls=1&mt=8"})}])}(),function(){app.controller("QiwiCtrl",["$scope","$http","$location","$timeout",function(e,t,n){var o=this;o.data={};var r=n.search();o.complete=function(){var n=o.data.phone.replace(/\D/g,"");t({method:"post",url:"/api/billing/invoicing",data:{op_id:r.op_id,payment_method_id:r.payment_method_id,data:{user:n}}}).success(function(t){t.isSuccessful?window.top.location.href=r.pay_url:e.form.showErrors(e,t)})}}])}();